<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" /><br /><a name="l2" /></span><span style="color: #007700">require&nbsp;</span><span style="color: #DD0000">'autoload.php'</span><span style="color: #007700">;<br /><a name="l3" /><br /><a name="l4" />use&nbsp;</span><span style="color: #0000BB">Mike42</span><span style="color: #007700">\</span><span style="color: #0000BB">Escpos</span><span style="color: #007700">\</span><span style="color: #0000BB">Printer</span><span style="color: #007700">;<br /><a name="l5" />use&nbsp;</span><span style="color: #0000BB">Mike42</span><span style="color: #007700">\</span><span style="color: #0000BB">Escpos</span><span style="color: #007700">\</span><span style="color: #0000BB">EscposImage</span><span style="color: #007700">;<br /><a name="l6" />use&nbsp;</span><span style="color: #0000BB">Mike42</span><span style="color: #007700">\</span><span style="color: #0000BB">Escpos</span><span style="color: #007700">\</span><span style="color: #0000BB">PrintConnectors</span><span style="color: #007700">\</span><span style="color: #0000BB">NetworkPrintConnector</span><span style="color: #007700">;<br /><a name="l7" /><br /><a name="l8" /></span><span style="color: #FF8000">/*<br /><a name="l9" />&nbsp;*&nbsp;&nbsp;receipt.php&nbsp;:&nbsp;RESTful&nbsp;interface&nbsp;for&nbsp;thermal&nbsp;printer<br /><a name="l10" />&nbsp;*<br /><a name="l11" />&nbsp;*&nbsp;&nbsp;Arun&nbsp;Kalahasti&nbsp;&amp;&nbsp;Jonathan&nbsp;Le,&nbsp;FabLab&nbsp;Dev<br /><a name="l12" />&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;FabLab&nbsp;@&nbsp;University&nbsp;of&nbsp;Texas&nbsp;at&nbsp;Arlington<br /><a name="l13" />&nbsp;<br /><a name="l14" />&nbsp;*&nbsp;&nbsp;version:&nbsp;0.2&nbsp;alpha&nbsp;(2017-06-02)<br /><a name="l15" />&nbsp;*<br /><a name="l16" />*/<br /><a name="l17" /><br /><a name="l18" />//&nbsp;Prints&nbsp;then&nbsp;replies&nbsp;via&nbsp;JSON&nbsp;data&nbsp;exchange<br /><a name="l19" />//&nbsp;=======================================<br /><a name="l20" />//&nbsp;Header:<br /><a name="l21" />//&nbsp;&nbsp;&nbsp;&nbsp;FabLab&nbsp;logo<br /><a name="l22" />//&nbsp;&nbsp;&nbsp;&nbsp;Current&nbsp;Date&nbsp;and&nbsp;Time<br /><a name="l23" />//&nbsp;&nbsp;&nbsp;&nbsp;Transaction&nbsp;ID<br /><a name="l24" />//&nbsp;=======================================<br /><a name="l25" />//&nbsp;Receipt&nbsp;types:<br /><a name="l26" />//&nbsp;1)&nbsp;Transaction&nbsp;ID&nbsp;only<br /><a name="l27" />//&nbsp;2)&nbsp;Start&nbsp;Ticket<br /><a name="l28" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Filename<br /><a name="l29" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Estimated&nbsp;Time<br /><a name="l30" />//&nbsp;3)&nbsp;End&nbsp;Ticket<br /><a name="l31" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Filename<br /><a name="l32" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Cost<br /><a name="l33" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Filament&nbsp;Used<br /><a name="l34" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Time&nbsp;Ticket&nbsp;Opened<br /><a name="l35" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Time&nbsp;Ticket&nbsp;Closed<br /><a name="l36" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Actual&nbsp;Ticket&nbsp;Duration<br /><a name="l37" />//&nbsp;=======================================<br /><a name="l38" />//&nbsp;Footer:<br /><a name="l39" />//&nbsp;&nbsp;&nbsp;&nbsp;Barcode:<br /><a name="l40" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Transaction&nbsp;ID<br /><a name="l41" />//&nbsp;&nbsp;&nbsp;&nbsp;QR&nbsp;Code:<br /><a name="l42" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unique&nbsp;Transaction&nbsp;URL<br /><a name="l43" />//&nbsp;&nbsp;&nbsp;&nbsp;Website&nbsp;URL<br /><a name="l44" />//&nbsp;&nbsp;&nbsp;&nbsp;Phone&nbsp;Number<br /><a name="l45" /><br /><a name="l46" /><br /><a name="l47" />//require_once(&nbsp;__DIR__."/../../connections/tp_connect.php");<br /><a name="l48" /></span><span style="color: #007700">require_once(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">].</span><span style="color: #DD0000">"/connections/tp_connect.php"</span><span style="color: #007700">);<br /><a name="l49" /><br /><a name="l50" /></span><span style="color: #0000BB">$json_out&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><a name="l51" /><br /><a name="l52" /></span><span style="color: #FF8000">//&nbsp;Set&nbsp;up&nbsp;printer<br /><a name="l53" /></span><span style="color: #007700">try&nbsp;{<br /><a name="l54" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connector&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">NetworkPrintConnector</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$tphost</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tpport</span><span style="color: #007700">);<br /><a name="l55" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Printer</span><span style="color: #007700">(</span><span style="color: #0000BB">$connector</span><span style="color: #007700">);<br /><a name="l56" />}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$setup_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l57" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$setup_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br /><a name="l58" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l59" />}<br /><a name="l60" /><br /><a name="l61" /></span><span style="color: #FF8000">//$input_data&nbsp;=&nbsp;array(&nbsp;"type"&nbsp;=&gt;&nbsp;"start_ticket",&nbsp;"trans_id"&nbsp;=&gt;&nbsp;10000,"filename"&nbsp;=&gt;&nbsp;"Test&nbsp;Script",&nbsp;"est_cost"&nbsp;=&gt;&nbsp;"0.00",<br /><a name="l62" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"est_material"&nbsp;=&gt;&nbsp;"Test&nbsp;Material",&nbsp;"est_duration"&nbsp;=&gt;&nbsp;"00:00:00",&nbsp;"m_name"&nbsp;=&gt;&nbsp;"Test&nbsp;Material",<br /><a name="l63" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"device_name"&nbsp;=&gt;&nbsp;"Test&nbsp;Machine");<br /><a name="l64" /><br /><a name="l65" />//&nbsp;Input&nbsp;posted&nbsp;with&nbsp;"Content-Type:&nbsp;application/json"&nbsp;header<br /><a name="l66" /></span><span style="color: #0000BB">$input_data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">json_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">'php://input'</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l67" />if&nbsp;(!&nbsp;(</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">))&nbsp;{<br /><a name="l68" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"Unable&nbsp;to&nbsp;decode&nbsp;JSON&nbsp;message&nbsp;-&nbsp;check&nbsp;syntax"</span><span style="color: #007700">;<br /><a name="l69" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l70" />}<br /><a name="l71" /><br /><a name="l72" /></span><span style="color: #FF8000">//&nbsp;Tell&nbsp;PHP&nbsp;what&nbsp;time&nbsp;zone&nbsp;before&nbsp;doing&nbsp;any&nbsp;date&nbsp;function&nbsp;foo&nbsp;<br /><a name="l73" /></span><span style="color: #0000BB">date_default_timezone_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'America/Chicago'</span><span style="color: #007700">);<br /><a name="l74" /><br /><a name="l75" /></span><span style="color: #FF8000">//&nbsp;Extract&nbsp;message&nbsp;type&nbsp;and&nbsp;transaction&nbsp;id&nbsp;from&nbsp;incoming&nbsp;JSON<br /><a name="l76" /></span><span style="color: #0000BB">$trans_id&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"trans_id"</span><span style="color: #007700">];<br /><a name="l77" />if&nbsp;(!&nbsp;(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">))&nbsp;{<br /><a name="l78" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"trans_id&nbsp;key&nbsp;not&nbsp;found"</span><span style="color: #007700">;<br /><a name="l79" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l80" />}<br /><a name="l81" /></span><span style="color: #0000BB">$type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"type"</span><span style="color: #007700">];<br /><a name="l82" />if&nbsp;(!&nbsp;(</span><span style="color: #0000BB">$type</span><span style="color: #007700">))&nbsp;{<br /><a name="l83" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$type&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"trans_id"</span><span style="color: #007700">;<br /><a name="l84" />}<br /><a name="l85" /><br /><a name="l86" /></span><span style="color: #FF8000">//&nbsp;Print&nbsp;Header<br /><a name="l87" /></span><span style="color: #0000BB">PrintHeader</span><span style="color: #007700">();<br /><a name="l88" /><br /><a name="l89" />try&nbsp;{<br /><a name="l90" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Check&nbsp;the&nbsp;request&nbsp;type<br /><a name="l91" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">strtolower</span><span style="color: #007700">(</span><span style="color: #0000BB">$type</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #DD0000">"trans_id"</span><span style="color: #007700">)&nbsp;{<br /><a name="l92" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;No&nbsp;main&nbsp;body<br /><a name="l93" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}&nbsp;elseif&nbsp;(</span><span style="color: #0000BB">strtolower</span><span style="color: #007700">(</span><span style="color: #0000BB">$type</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #DD0000">"start_ticket"</span><span style="color: #007700">)&nbsp;{<br /><a name="l94" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"filename"</span><span style="color: #007700">];<br /><a name="l95" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$est_cost&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"est_cost"</span><span style="color: #007700">];<br /><a name="l96" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$est_material&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"est_material"</span><span style="color: #007700">];<br /><a name="l97" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$est_duration&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"est_duration"</span><span style="color: #007700">];<br /><a name="l98" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$filament_type&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"m_name"</span><span style="color: #007700">];<br /><a name="l99" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$device_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"device_name"</span><span style="color: #007700">];<br /><a name="l100" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">StartTicket</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$est_cost</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$est_material</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$est_duration</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$filament_type</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$device_name</span><span style="color: #007700">);<br /><a name="l101" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(</span><span style="color: #0000BB">strtolower</span><span style="color: #007700">(</span><span style="color: #0000BB">$type</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #DD0000">"end_ticket"</span><span style="color: #007700">)&nbsp;{<br /><a name="l102" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"filename"</span><span style="color: #007700">];<br /><a name="l103" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cost&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"cost"</span><span style="color: #007700">];<br /><a name="l104" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$filament_used&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"filament_used"</span><span style="color: #007700">];<br /><a name="l105" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$time_opened&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"time_opened"</span><span style="color: #007700">];<br /><a name="l106" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$time_closed&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"time_closed"</span><span style="color: #007700">];<br /><a name="l107" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$duration&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$input_data</span><span style="color: #007700">[</span><span style="color: #DD0000">"duration"</span><span style="color: #007700">];<br /><a name="l108" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">EndTicket</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,</span><span style="color: #0000BB">$cost</span><span style="color: #007700">,</span><span style="color: #0000BB">$filament_used</span><span style="color: #007700">,</span><span style="color: #0000BB">$time_opened</span><span style="color: #007700">,</span><span style="color: #0000BB">$time_closed</span><span style="color: #007700">,</span><span style="color: #0000BB">$duration</span><span style="color: #007700">);<br /><a name="l109" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l110" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"Unknown&nbsp;type:&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br /><a name="l111" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l112" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l113" />}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$print_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l114" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$print_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br /><a name="l115" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l116" />}<br /><a name="l117" /><br /><a name="l118" /></span><span style="color: #FF8000">//&nbsp;Print&nbsp;Footer<br /><a name="l119" /></span><span style="color: #0000BB">PrintFooter</span><span style="color: #007700">();<br /><a name="l120" /><br /><a name="l121" /></span><span style="color: #FF8000">//&nbsp;Close&nbsp;Printer&nbsp;Connection<br /><a name="l122" /></span><span style="color: #007700">try&nbsp;{<br /><a name="l123" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l124" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l125" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">cut</span><span style="color: #007700">();<br /><a name="l126" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l127" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Close&nbsp;printer&nbsp;*/<br /><a name="l128" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /><a name="l129" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l130" />}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l131" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Couldn't&nbsp;print&nbsp;to&nbsp;this&nbsp;printer:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><a name="l132" />}<br /><a name="l133" /><br /><a name="l134" /></span><span style="color: #FF8000">//&nbsp;Output&nbsp;JSON&nbsp;and&nbsp;exit<br /><a name="l135" /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-Type:&nbsp;application/json"</span><span style="color: #007700">);<br /><a name="l136" />echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">);<br /><a name="l137" />exit(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><a name="l138" /><br /><a name="l139" /><br /><a name="l140" /></span><span style="color: #FF8000">////////////////////////////////////////////////////////////////<br /><a name="l141" />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Functions<br /><a name="l142" />////////////////////////////////////////////////////////////////<br /><a name="l143" /><br /><a name="l144" />////////////////////////////////////////////////////////////////<br /><a name="l145" />//<br /><a name="l146" />//&nbsp;&nbsp;EndTicket<br /><a name="l147" />//&nbsp;&nbsp;Prints&nbsp;end&nbsp;tran&nbsp;ticket.&nbsp;Contains&nbsp;all&nbsp;possible&nbsp;information.<br /><a name="l148" /><br /><a name="l149" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">EndTicket&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,</span><span style="color: #0000BB">$cost</span><span style="color: #007700">,</span><span style="color: #0000BB">$filament_used</span><span style="color: #007700">,</span><span style="color: #0000BB">$time_opened</span><span style="color: #007700">,</span><span style="color: #0000BB">$time_closed</span><span style="color: #007700">,</span><span style="color: #0000BB">$duration</span><span style="color: #007700">)&nbsp;{<br /><a name="l150" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">;<br /><a name="l151" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">;<br /><a name="l152" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l153" />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l154" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l155" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l156" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Filename:&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /><a name="l157" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l158" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Cost:&nbsp;&nbsp;$"</span><span style="color: #007700">.</span><span style="color: #0000BB">$cost</span><span style="color: #007700">);<br /><a name="l159" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l160" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Filament&nbsp;Used:&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$filament_used</span><span style="color: #007700">);<br /><a name="l161" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l162" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Time&nbsp;Started:&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$time_opened</span><span style="color: #007700">);<br /><a name="l163" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l164" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Time&nbsp;Ended:&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$time_closed</span><span style="color: #007700">);<br /><a name="l165" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l166" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Duration:&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$duration</span><span style="color: #007700">);<br /><a name="l167" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l168" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l169" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l170" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l171" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$print_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l172" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$print_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br /><a name="l173" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l174" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l175" />}<br /><a name="l176" /><br /><a name="l177" /></span><span style="color: #FF8000">////////////////////////////////////////////////////////////////<br /><a name="l178" />//<br /><a name="l179" />//&nbsp;&nbsp;StartTicket<br /><a name="l180" />//&nbsp;&nbsp;Prints&nbsp;start&nbsp;ticket.&nbsp;<br /><a name="l181" /><br /><a name="l182" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">StartTicket&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$est_cost</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$est_material</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$est_duration</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$filament_type</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$device_name</span><span style="color: #007700">)&nbsp;{<br /><a name="l183" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">;<br /><a name="l184" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">;<br /><a name="l185" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l186" />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l187" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l188" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Device:&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$device_name</span><span style="color: #007700">);<br /><a name="l189" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l190" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Color:&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$filament_type</span><span style="color: #007700">);<br /><a name="l191" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l192" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Est.&nbsp;Amount:&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$est_material</span><span style="color: #007700">);<br /><a name="l193" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l194" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Est.&nbsp;Cost:&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">);<br /><a name="l195" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"$&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">number_format</span><span style="color: #007700">(</span><span style="color: #0000BB">$est_cost</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">));<br /><a name="l196" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l197" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Est.&nbsp;Duration:&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$est_duration</span><span style="color: #007700">);<br /><a name="l198" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l199" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"File:&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /><a name="l200" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /><a name="l201" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Address:&nbsp;______________________"</span><span style="color: #007700">);<br /><a name="l202" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l203" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l204" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$print_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l205" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$print_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br /><a name="l206" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l207" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l208" />}<br /><a name="l209" /><br /><a name="l210" /></span><span style="color: #FF8000">////////////////////////////////////////////////////////////////<br /><a name="l211" />//<br /><a name="l212" />//&nbsp;&nbsp;PrintHeader<br /><a name="l213" />//&nbsp;&nbsp;Prints&nbsp;Generic&nbsp;Header<br /><a name="l214" /><br /><a name="l215" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">PrintHeader&nbsp;</span><span style="color: #007700">()&nbsp;{<br /><a name="l216" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">;<br /><a name="l217" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">;<br /><a name="l218" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">;<br /><a name="l219" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l220" />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l221" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$img&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">EscposImage</span><span style="color: #007700">::</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">"../../images/fablab2.png"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><a name="l222" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l223" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_CENTER</span><span style="color: #007700">);<br /><a name="l224" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">graphics</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /><a name="l225" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l226" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"F&nbsp;j,&nbsp;Y&nbsp;h:i&nbsp;A"</span><span style="color: #007700">));<br /><a name="l227" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l228" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Ticket:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);<br /><a name="l229" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l230" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l231" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$print_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l232" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$print_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br /><a name="l233" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l234" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l235" />}<br /><a name="l236" /><br /><a name="l237" /><br /><a name="l238" /></span><span style="color: #FF8000">////////////////////////////////////////////////////////////////<br /><a name="l239" />//<br /><a name="l240" />//&nbsp;&nbsp;PrintFooter<br /><a name="l241" />//&nbsp;&nbsp;Prints&nbsp;Generic&nbsp;Footer<br /><a name="l242" /><br /><a name="l243" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">PrintFooter&nbsp;</span><span style="color: #007700">()&nbsp;{<br /><a name="l244" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">;<br /><a name="l245" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">;<br /><a name="l246" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">;<br /><a name="l247" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l248" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$qr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"http://fabapp.uta.edu/look.php?trans_id="</span><span style="color: #007700">.</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">;<br /><a name="l249" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l250" />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l251" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l252" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l253" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//$printer&nbsp;-&gt;&nbsp;qrCode($qr,&nbsp;Printer::QR_ECLEVEL_L,&nbsp;5,&nbsp;Printer::QR_MODEL_2);<br /><a name="l254" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$printer&nbsp;-&gt;&nbsp;feed();<br /><a name="l255" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$printer-&gt;setBarcodeTextPosition(Printer::BARCODE_TEXT_BELOW);<br /><a name="l256" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$printer-&gt;barcode(&nbsp;(string)$trans_id,&nbsp;Printer::BARCODE_CODE39);<br /><a name="l257" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$printer&nbsp;-&gt;&nbsp;feed();<br /><a name="l258" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Potential&nbsp;Problems?&nbsp;&nbsp;(&nbsp;Y&nbsp;)&nbsp;&nbsp;(&nbsp;N&nbsp;)"</span><span style="color: #007700">);<br /><a name="l259" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l260" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"NOTES:&nbsp;_________________________"</span><span style="color: #007700">);<br /><a name="l261" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l262" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"________________________________"</span><span style="color: #007700">);<br /><a name="l263" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l264" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"________________________________"</span><span style="color: #007700">);<br /><a name="l265" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /><a name="l266" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//$printer&nbsp;-&gt;&nbsp;text("|______________|________________|");<br /><a name="l267" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$printer&nbsp;-&gt;&nbsp;feed();<br /><a name="l268" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$printer&nbsp;-&gt;setFont(Printer::FONT_B);<br /><a name="l269" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$printer&nbsp;-&gt;&nbsp;text("learner&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;");<br /><a name="l270" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">graphics</span><span style="color: #007700">(</span><span style="color: #0000BB">EscposImage</span><span style="color: #007700">::</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">"../../images/sig.png"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">));<br /><a name="l271" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setFont</span><span style="color: #007700">();<br /><a name="l272" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l273" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://fablab.uta.edu/"</span><span style="color: #007700">);<br /><a name="l274" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l275" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"(817)&nbsp;272-1785"</span><span style="color: #007700">);<br /><a name="l276" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l277" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l278" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$print_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l279" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$print_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br /><a name="l280" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ErrorExitR</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l281" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l282" />}<br /><a name="l283" /><br /><a name="l284" /></span><span style="color: #FF8000">////////////////////////////////////////////////////////////////<br /><a name="l285" />//<br /><a name="l286" />//&nbsp;&nbsp;ErrorExitR<br /><a name="l287" />//&nbsp;&nbsp;Sends&nbsp;error&nbsp;message&nbsp;and&nbsp;quits&nbsp;<br /><a name="l288" /><br /><a name="l289" /><br /><a name="l290" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">ErrorExitR&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$exit_status</span><span style="color: #007700">)&nbsp;{<br /><a name="l291" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">;<br /><a name="l292" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">;<br /><a name="l293" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l294" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$printer</span><span style="color: #007700">)&nbsp;{<br /><a name="l295" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l296" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Print&nbsp;Error<br /><a name="l297" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"ERROR:\n"</span><span style="color: #007700">);<br /><a name="l298" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">prettyPrint</span><span style="color: #007700">(</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">)));<br /><a name="l299" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l300" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Feed&nbsp;and&nbsp;cut&nbsp;ticket<br /><a name="l301" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l302" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">cut</span><span style="color: #007700">();<br /><a name="l303" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$fatal_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l304" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$fatal_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;Crashed&nbsp;during&nbsp;error&nbsp;printing"</span><span style="color: #007700">;<br /><a name="l305" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l306" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Close&nbsp;printer<br /><a name="l307" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /><a name="l308" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l309" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l310" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-Type:&nbsp;application/json"</span><span style="color: #007700">);<br /><a name="l311" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">);<br /><a name="l312" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l313" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l314" />&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color: #0000BB">$exit_status</span><span style="color: #007700">);<br /><a name="l315" />}<br /><a name="l316" /><br /><a name="l317" /><br /><a name="l318" /></span><span style="color: #FF8000">////////////////////////////////////////////////////////////////<br /><a name="l319" />//<br /><a name="l320" />//&nbsp;&nbsp;prettyPrint<br /><a name="l321" />//&nbsp;&nbsp;This&nbsp;function&nbsp;will&nbsp;take&nbsp;JSON&nbsp;string&nbsp;and&nbsp;indent&nbsp;it&nbsp;very&nbsp;readable.<br /><a name="l322" />//<br /><a name="l323" />//&nbsp;&nbsp;&nbsp;&nbsp;Code&nbsp;created&nbsp;with&nbsp;the&nbsp;help&nbsp;of&nbsp;Stack&nbsp;Overflow&nbsp;question<br /><a name="l324" />//&nbsp;&nbsp;&nbsp;&nbsp;http://stackoverflow.com/questions/6054033/pretty-printing-json-with-php<br /><a name="l325" />//&nbsp;&nbsp;&nbsp;&nbsp;Question&nbsp;by&nbsp;Zach&nbsp;Rattner:<br /><a name="l326" />//&nbsp;&nbsp;&nbsp;&nbsp;http://stackoverflow.com/users/371408/zach-rattner<br /><a name="l327" />//&nbsp;&nbsp;&nbsp;&nbsp;Answer&nbsp;by&nbsp;Kendall&nbsp;Hopkins:<br /><a name="l328" />//&nbsp;&nbsp;&nbsp;&nbsp;http://stackoverflow.com/users/188044/kendall-hopkins<br /><a name="l329" /><br /><a name="l330" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">prettyPrint</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$json&nbsp;</span><span style="color: #007700">)<br /><a name="l331" />{<br /><a name="l332" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br /><a name="l333" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><a name="l334" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in_quotes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l335" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in_escape&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l336" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ends_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br /><a name="l337" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_length&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$json&nbsp;</span><span style="color: #007700">);<br /><a name="l338" /><br /><a name="l339" />&nbsp;&nbsp;&nbsp;&nbsp;for(&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$json_length</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++&nbsp;)&nbsp;{<br /><a name="l340" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$char&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$json</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">];<br /><a name="l341" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$new_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br /><a name="l342" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$post&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l343" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;</span><span style="color: #0000BB">$ends_line_level&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">NULL&nbsp;</span><span style="color: #007700">)&nbsp;{<br /><a name="l344" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$new_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$ends_line_level</span><span style="color: #007700">;<br /><a name="l345" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ends_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br /><a name="l346" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l347" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;</span><span style="color: #0000BB">$in_escape&nbsp;</span><span style="color: #007700">)&nbsp;{<br /><a name="l348" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in_escape&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l349" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(&nbsp;</span><span style="color: #0000BB">$char&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #DD0000">'"'&nbsp;</span><span style="color: #007700">)&nbsp;{<br /><a name="l350" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in_quotes&nbsp;</span><span style="color: #007700">=&nbsp;!</span><span style="color: #0000BB">$in_quotes</span><span style="color: #007700">;<br /><a name="l351" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(&nbsp;!&nbsp;</span><span style="color: #0000BB">$in_quotes&nbsp;</span><span style="color: #007700">)&nbsp;{<br /><a name="l352" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(&nbsp;</span><span style="color: #0000BB">$char&nbsp;</span><span style="color: #007700">)&nbsp;{<br /><a name="l353" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">'}'</span><span style="color: #007700">:&nbsp;case&nbsp;</span><span style="color: #DD0000">']'</span><span style="color: #007700">:<br /><a name="l354" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$level</span><span style="color: #007700">--;<br /><a name="l355" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ends_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br /><a name="l356" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$new_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$level</span><span style="color: #007700">;<br /><a name="l357" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br /><a name="l358" /><br /><a name="l359" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">'{'</span><span style="color: #007700">:&nbsp;case&nbsp;</span><span style="color: #DD0000">'['</span><span style="color: #007700">:<br /><a name="l360" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$level</span><span style="color: #007700">++;<br /><a name="l361" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">','</span><span style="color: #007700">:<br /><a name="l362" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ends_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$level</span><span style="color: #007700">;<br /><a name="l363" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br /><a name="l364" /><br /><a name="l365" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">':'</span><span style="color: #007700">:<br /><a name="l366" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$post&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">;<br /><a name="l367" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br /><a name="l368" /><br /><a name="l369" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">:&nbsp;case&nbsp;</span><span style="color: #DD0000">"\t"</span><span style="color: #007700">:&nbsp;case&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">:&nbsp;case&nbsp;</span><span style="color: #DD0000">"\r"</span><span style="color: #007700">:<br /><a name="l370" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$char&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l371" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ends_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$new_line_level</span><span style="color: #007700">;<br /><a name="l372" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$new_line_level&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br /><a name="l373" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br /><a name="l374" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l375" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(&nbsp;</span><span style="color: #0000BB">$char&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #DD0000">'\\'&nbsp;</span><span style="color: #007700">)&nbsp;{<br /><a name="l376" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in_escape&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><a name="l377" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l378" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;</span><span style="color: #0000BB">$new_line_level&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">NULL&nbsp;</span><span style="color: #007700">)&nbsp;{<br /><a name="l379" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">.</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(&nbsp;</span><span style="color: #DD0000">"\t"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$new_line_level&nbsp;</span><span style="color: #007700">);<br /><a name="l380" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l381" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #0000BB">$char</span><span style="color: #007700">.</span><span style="color: #0000BB">$post</span><span style="color: #007700">;<br /><a name="l382" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l383" /><br /><a name="l384" />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">;<br /><a name="l385" />}<br /><a name="l386" /><br /><a name="l387" /></span><span style="color: #0000BB">?&gt;</span>
</span>