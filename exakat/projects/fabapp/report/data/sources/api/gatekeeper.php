<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" /></span><span style="color: #FF8000">/*<br /><a name="l2" />&nbsp;*&nbsp;&nbsp;&nbsp;CC&nbsp;BY-NC-AS&nbsp;UTA&nbsp;FabLab&nbsp;2016-2017<br /><a name="l3" />&nbsp;*&nbsp;&nbsp;&nbsp;FabApp&nbsp;V&nbsp;0.9<br /><a name="l4" />&nbsp;*/<br /><a name="l5" /></span><span style="color: #007700">include_once&nbsp;(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">].</span><span style="color: #DD0000">'/class/Users.php'</span><span style="color: #007700">);<br /><a name="l6" /><br /><a name="l7" /></span><span style="color: #FF8000">///////////////////////////////////////////////////////////////<br /><a name="l8" />//<br /><a name="l9" />//&nbsp;&nbsp;&nbsp;Gatekeeper<br /><a name="l10" />//&nbsp;&nbsp;&nbsp;Checks&nbsp;to&nbsp;see&nbsp;if&nbsp;ID&nbsp;is&nbsp;authorized&nbsp;to&nbsp;use&nbsp;a&nbsp;FabLab&nbsp;device<br /><a name="l11" />//<br /><a name="l12" /><br /><a name="l13" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">gatekeeper&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$operator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$d_id</span><span style="color: #007700">)&nbsp;{<br /><a name="l14" />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">;<br /><a name="l15" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l16" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">is_a</span><span style="color: #007700">(</span><span style="color: #0000BB">$operator</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"Users"</span><span style="color: #007700">)){<br /><a name="l17" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$operator</span><span style="color: #007700">;<br /><a name="l18" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l19" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Users</span><span style="color: #007700">::</span><span style="color: #0000BB">withID</span><span style="color: #007700">(</span><span style="color: #0000BB">$operator</span><span style="color: #007700">);<br /><a name="l20" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l21" /><br /><a name="l22" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Check&nbsp;to&nbsp;see&nbsp;if&nbsp;ID&nbsp;is&nbsp;a&nbsp;10-digit&nbsp;number<br /><a name="l23" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">is_object</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">))&nbsp;{<br /><a name="l24" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Bad&nbsp;ID"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l25" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l26" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l27" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Check&nbsp;to&nbsp;see&nbsp;if&nbsp;device&nbsp;ID&nbsp;is&nbsp;a&nbsp;valid&nbsp;any-digit&nbsp;number<br /><a name="l28" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">Devices</span><span style="color: #007700">::</span><span style="color: #0000BB">regexDeviceID</span><span style="color: #007700">(</span><span style="color: #0000BB">$d_id</span><span style="color: #007700">))&nbsp;{<br /><a name="l29" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Invalid&nbsp;or&nbsp;missing&nbsp;device&nbsp;id&nbsp;value&nbsp;-&nbsp;</span><span style="color: #0000BB">$d_id</span><span style="color: #DD0000">"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l30" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l31" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$device&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Devices</span><span style="color: #007700">(</span><span style="color: #0000BB">$d_id</span><span style="color: #007700">);<br /><a name="l32" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l33" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l34" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Prevent&nbsp;new&nbsp;Ticket&nbsp;if&nbsp;previous&nbsp;ticket&nbsp;has&nbsp;not&nbsp;been&nbsp;closed<br /><a name="l35" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l36" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;<br /><a name="l37" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;`transactions`<br /><a name="l38" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;devices<br /><a name="l39" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;devices.d_id&nbsp;=&nbsp;transactions.d_id<br /><a name="l40" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;devices.d_id&nbsp;=&nbsp;</span><span style="color: #0000BB">$d_id</span><span style="color: #DD0000">&nbsp;AND&nbsp;status_id&nbsp;&lt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #0000BB">total_fail</span><span style="color: #007700">]</span><span style="color: #DD0000"><br /><a name="l41" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIMIT&nbsp;1;<br /><a name="l42" />&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l43" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">num_rows&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">){<br /><a name="l44" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">();<br /><a name="l45" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Can&nbsp;not&nbsp;start&nbsp;new&nbsp;Ticket&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #0000BB">trans_id</span><span style="color: #007700">]</span><span style="color: #DD0000">&nbsp;on&nbsp;this&nbsp;device&nbsp;until&nbsp;previous&nbsp;ticket&nbsp;has&nbsp;been&nbsp;closed."</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l46" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l47" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l48" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"gk"</span><span style="color: #007700">.</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l49" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l50" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l51" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Deny&nbsp;Print&nbsp;if&nbsp;they&nbsp;have&nbsp;prints&nbsp;to&nbsp;pickup<br /><a name="l52" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l53" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br /><a name="l54" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;`storage_box`<br /><a name="l55" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;`transactions`&nbsp;ON&nbsp;`transactions`.`trans_id`&nbsp;=&nbsp;`storage_box`.`trans_id`<br /><a name="l56" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;`devices`&nbsp;ON&nbsp;`transactions`.`d_id`&nbsp;=&nbsp;`devices`.`d_id`<br /><a name="l57" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;`device_group`&nbsp;ON&nbsp;`device_group`.`dg_id`&nbsp;=&nbsp;`devices`.`dg_id`<br /><a name="l58" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`transactions`.`operator`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">'<br /><a name="l59" />&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l60" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">num_rows&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">){<br /><a name="l61" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Current&nbsp;Time<br /><a name="l62" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$now&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DateTime</span><span style="color: #007700">();<br /><a name="l63" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_array</span><span style="color: #007700">()){<br /><a name="l64" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Deny&nbsp;if&nbsp;Object&nbsp;in&nbsp;storage&nbsp;is&nbsp;from&nbsp;the&nbsp;same&nbsp;Device&nbsp;Group<br /><a name="l65" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Deny&nbsp;if&nbsp;Object&nbsp;in&nbsp;storage&nbsp;is&nbsp;older&nbsp;than&nbsp;maxHold<br /><a name="l66" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$o_start&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DateTime</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'item_change_time'</span><span style="color: #007700">]);<br /><a name="l67" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$o_start</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">DateInterval</span><span style="color: #007700">(</span><span style="color: #DD0000">"P"</span><span style="color: #007700">.</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'maxHold'</span><span style="color: #007700">].</span><span style="color: #DD0000">"D"</span><span style="color: #007700">));<br /><a name="l68" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l69" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((</span><span style="color: #0000BB">$device</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDg</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">parent&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'dg_parent'</span><span style="color: #007700">])&nbsp;||&nbsp;(</span><span style="color: #0000BB">$now&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">$o_start</span><span style="color: #007700">)){<br /><a name="l70" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Please&nbsp;Pay&nbsp;for&nbsp;Your&nbsp;Previous&nbsp;3D&nbsp;Print.&nbsp;See&nbsp;Ticket:&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'trans_id'</span><span style="color: #007700">],&nbsp;&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l71" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l72" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l73" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l74" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l75" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"gk"</span><span style="color: #007700">.</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l76" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l77" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">////////////////////////////////////////////////////////<br /><a name="l78" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l79" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;Deny&nbsp;if&nbsp;membership&nbsp;&lt;&nbsp;strtotime("now")<br /><a name="l80" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l81" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l82" />&nbsp;&nbsp;&nbsp;&nbsp;////////////////////////////////////////////////////////<br /><a name="l83" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l84" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;Deny&nbsp;if&nbsp;User&nbsp;has&nbsp;more&nbsp;than&nbsp;one&nbsp;device&nbsp;powered&nbsp;on<br /><a name="l85" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l86" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l87" />&nbsp;&nbsp;&nbsp;&nbsp;////////////////////////////////////////////////////////<br /><a name="l88" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l89" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;Deny&nbsp;if&nbsp;Device&nbsp;has&nbsp;a&nbsp;Service&nbsp;Ticket<br /><a name="l90" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l91" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l92" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br /><a name="l93" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;`service_call`<br /><a name="l94" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`d_id`&nbsp;=&nbsp;</span><span style="color: #0000BB">$d_id</span><span style="color: #DD0000">&nbsp;AND&nbsp;`solved`&nbsp;=&nbsp;'N'&nbsp;AND&nbsp;`sl_id`&nbsp;&gt;=7;<br /><a name="l95" />&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l96" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">num_rows&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">){<br /><a name="l97" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getRoleID</span><span style="color: #007700">()&nbsp;==&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'serviceTechnican'</span><span style="color: #007700">]&nbsp;||&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getRoleID</span><span style="color: #007700">()&nbsp;&gt;=&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'staffTechnican'</span><span style="color: #007700">]){<br /><a name="l98" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//No&nbsp;Problems&nbsp;Keep&nbsp;Working<br /><a name="l99" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}&nbsp;else&nbsp;{<br /><a name="l100" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//role&nbsp;id&nbsp;!=&nbsp;7&nbsp;or&nbsp;r_id&nbsp;&lt;&nbsp;10<br /><a name="l101" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"This&nbsp;device&nbsp;is&nbsp;Out&nbsp;of&nbsp;Service"</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"role"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getRoleID</span><span style="color: #007700">());<br /><a name="l102" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l103" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l104" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l105" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l106" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l107" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">////////////////////////////////////////////////////////<br /><a name="l108" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l109" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;User&nbsp;has&nbsp;an&nbsp;outstanding&nbsp;charge<br /><a name="l110" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l111" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ac_owed&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Acct_charge</span><span style="color: #007700">::</span><span style="color: #0000BB">checkOutstanding</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getOperator</span><span style="color: #007700">());<br /><a name="l112" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$ac_owed</span><span style="color: #007700">)&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(</span><span style="color: #0000BB">$ac_owed</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">){<br /><a name="l113" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$msg&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Over&nbsp;due&nbsp;balance&nbsp;for&nbsp;Ticket&nbsp;:"</span><span style="color: #007700">;<br /><a name="l114" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">array_keys</span><span style="color: #007700">(</span><span style="color: #0000BB">$ac_owed</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$aco_key</span><span style="color: #007700">){<br /><a name="l115" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$msg&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$msg</span><span style="color: #007700">.</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$aco_key</span><span style="color: #007700">.</span><span style="color: #DD0000">"&nbsp;&amp;"</span><span style="color: #007700">;<br /><a name="l116" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l117" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">rtrim</span><span style="color: #007700">(</span><span style="color: #0000BB">$msg</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"&amp;"</span><span style="color: #007700">),&nbsp;&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l118" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l119" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l120" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l121" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">////////////////////////////////////////////////////////<br /><a name="l122" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l123" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;Check&nbsp;to&nbsp;see&nbsp;if&nbsp;device&nbsp;has&nbsp;training&nbsp;modules<br /><a name="l124" />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><a name="l125" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$training&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><a name="l126" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$results&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l127" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;`trainingmodule`.`tm_id`,&nbsp;`trainingmodule`.`title`<br /><a name="l128" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;`trainingmodule`<br /><a name="l129" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;`devices`<br /><a name="l130" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;`trainingmodule`.`d_id`&nbsp;=&nbsp;`devices`.`d_id`<br /><a name="l131" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;devices.d_id&nbsp;=&nbsp;'</span><span style="color: #0000BB">$d_id</span><span style="color: #DD0000">'&nbsp;AND&nbsp;`tm_required`&nbsp;=&nbsp;'Y'<br /><a name="l132" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNION<br /><a name="l133" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;`trainingmodule`.`tm_id`,&nbsp;`trainingmodule`.`title`<br /><a name="l134" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;`trainingmodule`<br /><a name="l135" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;`devices`<br /><a name="l136" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;`trainingmodule`.`dg_id`&nbsp;=&nbsp;`devices`.`dg_id`<br /><a name="l137" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`devices`.`d_id`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$d_id</span><span style="color: #DD0000">'&nbsp;AND&nbsp;`tm_required`&nbsp;=&nbsp;'Y'<br /><a name="l138" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNION<br /><a name="l139" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;`trainingmodule`.`tm_id`,&nbsp;`trainingmodule`.`title`<br /><a name="l140" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;`trainingmodule`<br /><a name="l141" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;`device_group`<br /><a name="l142" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;`trainingmodule`.`dg_id`&nbsp;=&nbsp;`device_group`.`dg_parent`<br /><a name="l143" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;`devices`<br /><a name="l144" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;`device_group`.`dg_id`&nbsp;=&nbsp;`devices`.`dg_id`<br /><a name="l145" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`devices`.`d_id`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$d_id</span><span style="color: #DD0000">'&nbsp;AND&nbsp;`tm_required`&nbsp;=&nbsp;'Y';<br /><a name="l146" />&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l147" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(&nbsp;</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$results</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">()&nbsp;)&nbsp;{<br /><a name="l148" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$training</span><span style="color: #007700">[</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"tm_id"</span><span style="color: #007700">]]&nbsp;=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"title"</span><span style="color: #007700">];<br /><a name="l149" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l150" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$results</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /><a name="l151" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l152" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l153" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l154" /><br /><a name="l155" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$training</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br /><a name="l156" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;If&nbsp;device&nbsp;has&nbsp;no&nbsp;training&nbsp;modules,&nbsp;no&nbsp;need&nbsp;to&nbsp;check&nbsp;further<br /><a name="l157" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;so&nbsp;exit&nbsp;the&nbsp;function.<br /><a name="l158" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//echo&nbsp;"No&nbsp;Training&nbsp;Required";<br /><a name="l159" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"active"</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Y"</span><span style="color: #007700">);<br /><a name="l160" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l161" /><br /><a name="l162" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Check&nbsp;if&nbsp;user&nbsp;has&nbsp;completed&nbsp;the&nbsp;necessary&nbsp;training&nbsp;modules<br /><a name="l163" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><a name="l164" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//foreach($training&nbsp;as&nbsp;$t){<br /><a name="l165" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$training&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$tm_id&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$title</span><span style="color: #007700">){<br /><a name="l166" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$results&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l167" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br /><a name="l168" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;`tm_enroll`<br /><a name="l169" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`tm_enroll`.`tm_id`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$tm_id</span><span style="color: #DD0000">'&nbsp;AND&nbsp;`operator`&nbsp;=&nbsp;'"</span><span style="color: #007700">.</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getOperator</span><span style="color: #007700">().</span><span style="color: #DD0000">"'<br /><a name="l170" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l171" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;</span><span style="color: #0000BB">$results</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">num_rows&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">)&nbsp;{<br /><a name="l172" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">++;<br /><a name="l173" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l174" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"ID:&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getOperator</span><span style="color: #007700">().</span><span style="color: #DD0000">"&nbsp;Needs&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$title</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l175" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l176" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l177" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l178" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l179" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l180" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l181" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$training</span><span style="color: #007700">)){<br /><a name="l182" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//echo&nbsp;"authorized";<br /><a name="l183" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Y"</span><span style="color: #007700">);<br /><a name="l184" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l185" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array&nbsp;(</span><span style="color: #DD0000">"status_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Gatekeeper&nbsp;:&nbsp;No&nbsp;Resolution"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"authorized"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">);<br /><a name="l186" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l187" />}<br /><a name="l188" /></span><span style="color: #0000BB">?&gt;</span>
</span>