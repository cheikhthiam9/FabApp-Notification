<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" />header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Access-Control-Allow-Origin:&nbsp;*"</span><span style="color: #007700">);<br /><a name="l2" /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Access-Control-Allow-Methods:&nbsp;GET,&nbsp;POST"</span><span style="color: #007700">);<br /><a name="l3" /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Access-Control-Allow-Headers:&nbsp;Cache-Control,&nbsp;Origin,&nbsp;X-Requested-With,&nbsp;Content-Type,&nbsp;Accept,&nbsp;Key,&nbsp;X-Api-Key,&nbsp;Authorization"</span><span style="color: #007700">);<br /><a name="l4" /><br /><a name="l5" /></span><span style="color: #FF8000">/*<br /><a name="l6" />&nbsp;*&nbsp;&nbsp;purpose.php&nbsp;:&nbsp;purpose&nbsp;list&nbsp;interface<br /><a name="l7" />&nbsp;*<br /><a name="l8" />&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;Arun&nbsp;Kalahasti&nbsp;&amp;&nbsp;Jon&nbsp;Le<br /><a name="l9" />&nbsp;*&nbsp;&nbsp;version:&nbsp;0.9&nbsp;alpha&nbsp;(2018-03-14)<br /><a name="l10" />&nbsp;*<br /><a name="l11" />*/<br /><a name="l12" /><br /><a name="l13" />//&nbsp;Requests/replies&nbsp;via&nbsp;JSON&nbsp;data&nbsp;exchange<br /><a name="l14" />//&nbsp;=======================================<br /><a name="l15" />//&nbsp;1)&nbsp;Get&nbsp;Materials&nbsp;By&nbsp;Device&nbsp;ID<br /><a name="l16" /><br /><a name="l17" /></span><span style="color: #007700">require_once(&nbsp;</span><span style="color: #0000BB">__DIR__</span><span style="color: #007700">.</span><span style="color: #DD0000">"/../connections/db_connect8.php"</span><span style="color: #007700">);<br /><a name="l18" />include_once&nbsp;(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">].</span><span style="color: #DD0000">'/class/all_classes.php'</span><span style="color: #007700">);<br /><a name="l19" /></span><span style="color: #0000BB">$json_out&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><a name="l20" /><br /><a name="l21" /></span><span style="color: #FF8000">//Compare&nbsp;Header&nbsp;API&nbsp;Key&nbsp;with&nbsp;site&nbsp;variable's&nbsp;API&nbsp;Key<br /><a name="l22" /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">apache_request_headers</span><span style="color: #007700">();<br /><a name="l23" />if&nbsp;(</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'api_key'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">)&nbsp;{<br /><a name="l24" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"api_key"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"Not&nbsp;Set"</span><span style="color: #007700">;<br /><a name="l25" />}&nbsp;elseif(isset(</span><span style="color: #0000BB">$headers</span><span style="color: #007700">[</span><span style="color: #DD0000">'authorization'</span><span style="color: #007700">])){<br /><a name="l26" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'api_key'</span><span style="color: #007700">]&nbsp;!=&nbsp;</span><span style="color: #0000BB">$headers</span><span style="color: #007700">[</span><span style="color: #DD0000">'authorization'</span><span style="color: #007700">]&nbsp;){<br /><a name="l27" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"authorized"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">;<br /><a name="l28" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"Unable&nbsp;to&nbsp;authenticate&nbsp;Device&nbsp;purpose"</span><span style="color: #007700">;<br /><a name="l29" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l30" />}&nbsp;elseif(isset(</span><span style="color: #0000BB">$headers</span><span style="color: #007700">[</span><span style="color: #DD0000">'Authorization'</span><span style="color: #007700">])){<br /><a name="l31" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'api_key'</span><span style="color: #007700">]&nbsp;!=&nbsp;</span><span style="color: #0000BB">$headers</span><span style="color: #007700">[</span><span style="color: #DD0000">'Authorization'</span><span style="color: #007700">]&nbsp;){<br /><a name="l32" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"authorized"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">;<br /><a name="l33" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"Unable&nbsp;to&nbsp;Authenticate&nbsp;Device&nbsp;purpose"</span><span style="color: #007700">;<br /><a name="l34" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l35" />}&nbsp;else&nbsp;{<br /><a name="l36" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"authorized"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">;<br /><a name="l37" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"Header&nbsp;Not&nbsp;Set"</span><span style="color: #007700">;<br /><a name="l38" />}<br /><a name="l39" /><br /><a name="l40" />if&nbsp;(!isset(</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">])){<br /><a name="l41" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqli_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"<br /><a name="l42" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;`p_id`,&nbsp;`p_title`&nbsp;AS&nbsp;purpose&nbsp;FROM&nbsp;`purpose`&nbsp;WHERE&nbsp;1;<br /><a name="l43" />&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">);<br /><a name="l44" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">)&nbsp;{<br /><a name="l45" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"authorized"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"N"</span><span style="color: #007700">;<br /><a name="l46" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">;<br /><a name="l47" />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l48" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQL_ASSOC</span><span style="color: #007700">))&nbsp;{<br /><a name="l49" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">;<br /><a name="l50" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l51" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l52" />}<br /><a name="l53" /><br /><a name="l54" /><br /><a name="l55" /></span><span style="color: #FF8000">//&nbsp;Output&nbsp;JSON&nbsp;and&nbsp;exit<br /><a name="l56" /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-Type:&nbsp;application/json"</span><span style="color: #007700">);<br /><a name="l57" />echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$json_out</span><span style="color: #007700">);<br /><a name="l58" />exit(</span><span style="color: #0000BB">0</span><span style="color: #007700">);</span>
</span>