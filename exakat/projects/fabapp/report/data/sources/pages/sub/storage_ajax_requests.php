<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" /><br /><a name="l2" /></span><span style="color: #FF8000">/***********************************************************************************************************<br /><a name="l3" />*&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l4" />*&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;MPZinke<br /><a name="l5" />*&nbsp;&nbsp;&nbsp;&nbsp;created&nbsp;on&nbsp;08.07.19&nbsp;<br /><a name="l6" />*&nbsp;&nbsp;&nbsp;&nbsp;CC&nbsp;BY-NC-AS&nbsp;UTA&nbsp;FabLab&nbsp;2016-2019<br /><a name="l7" />*&nbsp;&nbsp;&nbsp;&nbsp;FabApp&nbsp;V&nbsp;0.94<br /><a name="l8" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-House&nbsp;Keeping&nbsp;(DB&nbsp;cleanup,&nbsp;$status&nbsp;variable,&nbsp;class&nbsp;syntax)<br /><a name="l9" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Multiple&nbsp;Materials<br /><a name="l10" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Off-line&nbsp;Mode<br /><a name="l11" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Sheet&nbsp;Goods<br /><a name="l12" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Storage&nbsp;Box<br /><a name="l13" />*<br /><a name="l14" />*&nbsp;&nbsp;&nbsp;&nbsp;DESCRIPTION:&nbsp;AJAX&nbsp;POST&nbsp;call&nbsp;page&nbsp;to&nbsp;execute&nbsp;asyncronous&nbsp;JSON&nbsp;responses.&nbsp;&nbsp;Used<br /><a name="l15" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;end.php&nbsp;&amp;&nbsp;lookup.php.&nbsp;&nbsp;This&nbsp;page&nbsp;pertains&nbsp;to&nbsp;Storage&nbsp;Box:&nbsp;display&nbsp;drawer,&nbsp;confirm<br /><a name="l16" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;new&nbsp;drawer&nbsp;name&nbsp;or&nbsp;unit&nbsp;is&nbsp;not&nbsp;currently&nbsp;held&nbsp;by&nbsp;another&nbsp;drawer/unit<br /><a name="l17" />*&nbsp;&nbsp;&nbsp;&nbsp;FUTURE:&nbsp;<br /><a name="l18" />*&nbsp;&nbsp;&nbsp;&nbsp;BUGS:&nbsp;<br /><a name="l19" />*<br /><a name="l20" />***********************************************************************************************************/<br /><a name="l21" /><br /><a name="l22" />//&nbsp;echo&nbsp;json_encode(array("error"&nbsp;=&gt;&nbsp;"TEST"));<br /><a name="l23" /><br /><a name="l24" /></span><span style="color: #007700">include_once&nbsp;(</span><span style="color: #0000BB">filter_input</span><span style="color: #007700">(</span><span style="color: #0000BB">INPUT_SERVER</span><span style="color: #007700">,</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">).</span><span style="color: #DD0000">'/connections/db_connect8.php'</span><span style="color: #007700">);<br /><a name="l25" />include_once&nbsp;(</span><span style="color: #0000BB">filter_input</span><span style="color: #007700">(</span><span style="color: #0000BB">INPUT_SERVER</span><span style="color: #007700">,</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">).</span><span style="color: #DD0000">'/class/all_classes.php'</span><span style="color: #007700">);<br /><a name="l26" /><br /><a name="l27" /></span><span style="color: #FF8000">//&nbsp;authenticate&nbsp;permission&nbsp;for&nbsp;user<br /><a name="l28" /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br /><a name="l29" /></span><span style="color: #0000BB">$staff&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">unserialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'staff'</span><span style="color: #007700">]);<br /><a name="l30" />if(!</span><span style="color: #0000BB">$staff&nbsp;</span><span style="color: #007700">||&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleID&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$role</span><span style="color: #007700">[</span><span style="color: #DD0000">"staff"</span><span style="color: #007700">])&nbsp;exit();<br /><a name="l31" /><br /><a name="l32" /><br /><a name="l33" /><br /><a name="l34" /></span><span style="color: #FF8000">//&nbsp;get&nbsp;storage&nbsp;drawer&nbsp;with&nbsp;highlighted&nbsp;unit&nbsp;for&nbsp;unit&nbsp;type<br /><a name="l35" /></span><span style="color: #007700">if(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">"REQUEST_METHOD"</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"POST"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"drawer_for_type"</span><span style="color: #007700">]))&nbsp;{<br /><a name="l36" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$unit_type&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"unit_type"</span><span style="color: #007700">]);<br /><a name="l37" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$drawer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">StorageDrawer</span><span style="color: #007700">::</span><span style="color: #0000BB">get_a_drawer_and_unit_for_type</span><span style="color: #007700">(</span><span style="color: #0000BB">$unit_type</span><span style="color: #007700">);<br /><a name="l38" /><br /><a name="l39" />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">is_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$drawer</span><span style="color: #007700">))&nbsp;{<br /><a name="l40" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(</span><span style="color: #DD0000">"error"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$drawer</span><span style="color: #007700">));<br /><a name="l41" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();<br /><a name="l42" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l43" /><br /><a name="l44" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"drawer_HTML"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$drawer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">HTML_display</span><span style="color: #007700">(),&nbsp;<br /><a name="l45" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"drawer_label"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$drawer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">drawer_indicator</span><span style="color: #007700">,<br /><a name="l46" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"unit_label"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$drawer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">selected_units</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">unit_indicator</span><span style="color: #007700">));<br /><a name="l47" />}<br /><a name="l48" /><br /><a name="l49" /><br /><a name="l50" /></span><span style="color: #FF8000">//&nbsp;get&nbsp;all&nbsp;available/unoccupied&nbsp;units&nbsp;for&nbsp;drawer<br /><a name="l51" /></span><span style="color: #007700">if(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">"REQUEST_METHOD"</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"POST"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"choose_unit_in_drawer"</span><span style="color: #007700">]))&nbsp;{<br /><a name="l52" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$drawer_indicator&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"drawer_label"</span><span style="color: #007700">];<br /><a name="l53" /><br /><a name="l54" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;standard&nbsp;display&nbsp;for&nbsp;drawer<br /><a name="l55" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$standard_behavior&nbsp;</span><span style="color: #007700">=&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"style"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"background-color:#999999;border:solid;border-width:2px;"</span><span style="color: #007700">,&nbsp;<br /><a name="l56" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"onclick"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"alert(\"Box&nbsp;is&nbsp;occupied\");"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"label"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Occupied"</span><span style="color: #007700">);<br /><a name="l57" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$empty_behavior&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">"style"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"background-color:#000000;color:#000000;border:solid&nbsp;black;border-width:2px;"</span><span style="color: #007700">);<br /><a name="l58" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$selected_callback&nbsp;</span><span style="color: #007700">=&nbsp;function(</span><span style="color: #0000BB">$unit</span><span style="color: #007700">)&nbsp;{return&nbsp;!</span><span style="color: #0000BB">$unit</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id</span><span style="color: #007700">;};<br /><a name="l59" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$selected_behavior&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">"style"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"background-color:#00FF00;border:solid&nbsp;black;border-width:2px;"</span><span style="color: #007700">,&nbsp;<br /><a name="l60" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"onclick"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"add_to_location(this)"</span><span style="color: #007700">);<br /><a name="l61" /><br /><a name="l62" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$drawer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">StorageDrawer</span><span style="color: #007700">(</span><span style="color: #0000BB">$drawer_indicator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$standard_behavior</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$empty_behavior</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$selected_callback</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$selected_behavior</span><span style="color: #007700">);<br /><a name="l63" /><br /><a name="l64" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(</span><span style="color: #DD0000">"drawer_HTML"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$drawer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">HTML_display</span><span style="color: #007700">()));<br /><a name="l65" />}<br /><a name="l66" /><br /><a name="l67" /><br /><a name="l68" /></span><span style="color: #FF8000">//&nbsp;move&nbsp;in&nbsp;storage<br /><a name="l69" /></span><span style="color: #007700">if(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">"REQUEST_METHOD"</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"POST"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"move_to_new_location"</span><span style="color: #007700">]))&nbsp;{<br /><a name="l70" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$drawer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"drawer"</span><span style="color: #007700">]);<br /><a name="l71" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$unit&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"unit"</span><span style="color: #007700">]);<br /><a name="l72" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$trans_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"trans_id"</span><span style="color: #007700">]);<br /><a name="l73" /><br /><a name="l74" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$error&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">StorageObject</span><span style="color: #007700">::</span><span style="color: #0000BB">add_object_to_location_from_possible_previous</span><span style="color: #007700">(</span><span style="color: #0000BB">$drawer</span><span style="color: #007700">.</span><span style="color: #0000BB">$unit</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);<br /><a name="l75" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(</span><span style="color: #DD0000">"error"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">));<br /><a name="l76" />}<br /><a name="l77" /><br /><a name="l78" /><br /><a name="l79" /></span><span style="color: #FF8000">//&nbsp;move&nbsp;to&nbsp;storage<br /><a name="l80" /></span><span style="color: #007700">if(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">"REQUEST_METHOD"</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"POST"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"add_to_storage"</span><span style="color: #007700">]))&nbsp;{<br /><a name="l81" /><br /><a name="l82" />}<br /><a name="l83" /><br /><a name="l84" /></span><span style="color: #0000BB">?&gt;</span>
</span>