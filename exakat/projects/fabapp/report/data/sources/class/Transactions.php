<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" /><br /><a name="l2" /></span><span style="color: #FF8000">/***********************************************************************************************************<br /><a name="l3" />*&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l4" />*&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Jon&nbsp;Le<br /><a name="l5" />*&nbsp;&nbsp;&nbsp;&nbsp;Edited&nbsp;by:&nbsp;MPZinke&nbsp;on&nbsp;06.08.19&nbsp;to&nbsp;improve&nbsp;commenting&nbsp;an&nbsp;logic/functionality&nbsp;of&nbsp;class.<br /><a name="l6" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Separated&nbsp;physical&nbsp;location&nbsp;(storage_box)&nbsp;from&nbsp;censeptual&nbsp;information&nbsp;(transaction)&nbsp;in<br /><a name="l7" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preparation&nbsp;for&nbsp;StorageBox&nbsp;update.<br /><a name="l8" />*&nbsp;&nbsp;&nbsp;&nbsp;CC&nbsp;BY-NC-AS&nbsp;UTA&nbsp;FabLab&nbsp;2016-2019<br /><a name="l9" />*&nbsp;&nbsp;&nbsp;&nbsp;FabApp&nbsp;V&nbsp;0.94<br /><a name="l10" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-House&nbsp;Keeping&nbsp;(DB&nbsp;cleanup,&nbsp;$status&nbsp;variable,&nbsp;class&nbsp;syntax/functionality)<br /><a name="l11" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Multiple&nbsp;Materials<br /><a name="l12" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Off-line&nbsp;Mode<br /><a name="l13" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Sheet&nbsp;Goods<br /><a name="l14" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Storage&nbsp;Box<br /><a name="l15" />*<br /><a name="l16" />*&nbsp;&nbsp;&nbsp;&nbsp;DESCRIPTION:&nbsp;Transaction&nbsp;(Ticket)&nbsp;instance&nbsp;for&nbsp;device&nbsp;usage.&nbsp;&nbsp;Associates&nbsp;costs,&nbsp;user,<br /><a name="l17" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;devices,&nbsp;materials&nbsp;for&nbsp;creating/logging&nbsp;information&nbsp;in&nbsp;DB&nbsp;`transactions`.&nbsp;&nbsp;Prints&nbsp;hard&nbsp;copy<br /><a name="l18" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;tickets.&nbsp;&nbsp;Designed&nbsp;for&nbsp;by-page&nbsp;instance&nbsp;&amp;&nbsp;not&nbsp;transfering&nbsp;accross&nbsp;pages.&nbsp;&nbsp;If&nbsp;sent&nbsp;<br /><a name="l19" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pages,&nbsp;post&nbsp;creation&nbsp;changes&nbsp;(eg&nbsp;Materials)&nbsp;do&nbsp;not&nbsp;update<br /><a name="l20" />*<br /><a name="l21" />***********************************************************************************************************/<br /><a name="l22" />&nbsp;<br /><a name="l23" />//Thermal&nbsp;Reciept&nbsp;Dependancies<br /><a name="l24" /></span><span style="color: #007700">require_once&nbsp;(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">].</span><span style="color: #DD0000">'/api/php_printer/autoload.php'</span><span style="color: #007700">);<br /><a name="l25" />require_once&nbsp;(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">].</span><span style="color: #DD0000">'/connections/tp_connect.php'</span><span style="color: #007700">);<br /><a name="l26" />use&nbsp;</span><span style="color: #0000BB">Mike42</span><span style="color: #007700">\</span><span style="color: #0000BB">Escpos</span><span style="color: #007700">\</span><span style="color: #0000BB">Printer</span><span style="color: #007700">;<br /><a name="l27" />use&nbsp;</span><span style="color: #0000BB">Mike42</span><span style="color: #007700">\</span><span style="color: #0000BB">Escpos</span><span style="color: #007700">\</span><span style="color: #0000BB">EscposImage</span><span style="color: #007700">;<br /><a name="l28" />use&nbsp;</span><span style="color: #0000BB">Mike42</span><span style="color: #007700">\</span><span style="color: #0000BB">Escpos</span><span style="color: #007700">\</span><span style="color: #0000BB">PrintConnectors</span><span style="color: #007700">\</span><span style="color: #0000BB">NetworkPrintConnector</span><span style="color: #007700">;<br /><a name="l29" />&nbsp;<br /><a name="l30" />class&nbsp;</span><span style="color: #0000BB">Transactions&nbsp;</span><span style="color: #007700">{<br /><a name="l31" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$cost</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;costs&nbsp;associated&nbsp;with&nbsp;ticket;&nbsp;device&nbsp;usage&nbsp;+&nbsp;material&nbsp;usage<br /><a name="l32" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$duration</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;time&nbsp;a&nbsp;device&nbsp;took&nbsp;to&nbsp;complete&nbsp;task<br /><a name="l33" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$est_time</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;estimated&nbsp;time&nbsp;to&nbsp;do&nbsp;transaction&nbsp;task<br /><a name="l34" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$filename</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;used&nbsp;filename&nbsp;from&nbsp;`notes`&nbsp;with&nbsp;⦂&nbsp;following&nbsp;(eg&nbsp;my_file.gcode⦂&nbsp;)<br /><a name="l35" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$notes</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;note&nbsp;associated&nbsp;with&nbsp;transaction<br /><a name="l36" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$pickup_time</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;time&nbsp;item&nbsp;was&nbsp;picked&nbsp;up<br /><a name="l37" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$t_start</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;start&nbsp;time&nbsp;of&nbsp;transaction&nbsp;task<br /><a name="l38" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$t_end</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;end&nbsp;time&nbsp;of&nbsp;transaction&nbsp;task<br /><a name="l39" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;unique&nbsp;identifier&nbsp;of&nbsp;transaction<br /><a name="l40" />&nbsp;&nbsp;&nbsp;&nbsp;//Objects<br /><a name="l41" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$acct_charge</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;acount&nbsp;charge&nbsp;object&nbsp;based&nbsp;on&nbsp;trans_id<br /><a name="l42" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$device</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;device&nbsp;object&nbsp;based&nbsp;on&nbsp;device_id<br /><a name="l43" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$mats_used</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;material&nbsp;object(s)&nbsp;based&nbsp;on&nbsp;trans_id<br /><a name="l44" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$pickedup_by</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;person&nbsp;(mavID)&nbsp;that&nbsp;picked&nbsp;up&nbsp;item<br /><a name="l45" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$purpose</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;purpose&nbsp;object&nbsp;based&nbsp;on&nbsp;p_id<br /><a name="l46" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;fablab&nbsp;staff&nbsp;user&nbsp;object&nbsp;based&nbsp;on&nbsp;staff_id<br /><a name="l47" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;status&nbsp;object&nbsp;based&nbsp;on&nbsp;status<br /><a name="l48" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;person&nbsp;who&nbsp;started&nbsp;the&nbsp;print/ticket<br /><a name="l49" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l50" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">){<br /><a name="l51" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">;<br /><a name="l52" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l53" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #DD0000">"/^\d+$/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">))<br /><a name="l54" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">"Invalid&nbsp;Ticket&nbsp;Number&nbsp;:&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /><a name="l55" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l56" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l57" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br /><a name="l58" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;transactions<br /><a name="l59" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;trans_id&nbsp;=&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #DD0000"><br /><a name="l60" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIMIT&nbsp;1;<br /><a name="l61" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l62" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">num_rows&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">)&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">"Ticket&nbsp;Not&nbsp;Found&nbsp;:&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /><a name="l63" /><br /><a name="l64" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">();<br /><a name="l65" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">acct_charge&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Acct_charge</span><span style="color: #007700">::</span><span style="color: #0000BB">byTrans_id</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);<br /><a name="l66" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Devices</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'d_id'</span><span style="color: #007700">]);&nbsp;&nbsp;</span><span style="color: #FF8000">//REMOVE&nbsp;WITH&nbsp;UPDATE<br /><a name="l67" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'duration'</span><span style="color: #007700">];<br /><a name="l68" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$this-&gt;device&nbsp;=&nbsp;new&nbsp;Devices($row['device_id']);&nbsp;&nbsp;//ADD&nbsp;WITH&nbsp;UPDATE<br /><a name="l69" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">est_time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'est_time'</span><span style="color: #007700">];<br /><a name="l70" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'notes'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'notes'</span><span style="color: #007700">])[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /><a name="l71" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mats_used&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mats_Used</span><span style="color: #007700">::</span><span style="color: #0000BB">objects_by_trans_id</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'trans_id'</span><span style="color: #007700">]);<br /><a name="l72" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'notes'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">)&nbsp;?&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'notes'</span><span style="color: #007700">])[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'notes'</span><span style="color: #007700">];<br /><a name="l73" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">purpose&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Purpose</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'p_id'</span><span style="color: #007700">]);<br /><a name="l74" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pickup_time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'pickup_time'</span><span style="color: #007700">];<br /><a name="l75" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pickedup_by&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Users</span><span style="color: #007700">::</span><span style="color: #0000BB">withID</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'pickedup_by'</span><span style="color: #007700">]);<br /><a name="l76" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">staff&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Users</span><span style="color: #007700">::</span><span style="color: #0000BB">withID</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'staff_id'</span><span style="color: #007700">]);<br /><a name="l77" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Status</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'status_id'</span><span style="color: #007700">]);<br /><a name="l78" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'t_end'</span><span style="color: #007700">];<br /><a name="l79" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'t_start'</span><span style="color: #007700">];<br /><a name="l80" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'trans_id'</span><span style="color: #007700">];<br /><a name="l81" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Users</span><span style="color: #007700">::</span><span style="color: #0000BB">withID</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'operator'</span><span style="color: #007700">]);<br /><a name="l82" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l83" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l84" /><br /><a name="l85" /><br /><a name="l86" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;get&nbsp;the&nbsp;amount&nbsp;of&nbsp;credit&nbsp;(money&nbsp;already&nbsp;put&nbsp;forward)&nbsp;towards&nbsp;this&nbsp;transaction:&nbsp;replaced&nbsp;totalAC()<br /><a name="l87" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">current_transaction_credit</span><span style="color: #007700">(){<br /><a name="l88" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$total&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><a name="l89" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">Acct_charge</span><span style="color: #007700">::</span><span style="color: #0000BB">byTrans_id</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$acct_charge</span><span style="color: #007700">)<br /><a name="l90" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;do&nbsp;not&nbsp;include&nbsp;OutStanding&nbsp;Charges<br /><a name="l91" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$acct_charge</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">account</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">a_id&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">$total&nbsp;</span><span style="color: #007700">+=&nbsp;</span><span style="color: #0000BB">$acct_charge</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">amount</span><span style="color: #007700">;<br /><a name="l92" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$total</span><span style="color: #007700">;<br /><a name="l93" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l94" /><br /><a name="l95" /><br /><a name="l96" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;return&nbsp;the&nbsp;duration&nbsp;of&nbsp;the&nbsp;ticket&nbsp;in&nbsp;float-hours&nbsp;(or&nbsp;if&nbsp;greater&nbsp;minimum&nbsp;duration)<br /><a name="l97" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">duration_numeric</span><span style="color: #007700">(){<br /><a name="l98" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">;<br /><a name="l99" /><br /><a name="l100" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start</span><span style="color: #007700">)&nbsp;return&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><a name="l101" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">$end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">$end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"Y-m-d&nbsp;H:i:s"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #DD0000">"now"</span><span style="color: #007700">));&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l102" /><br /><a name="l103" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$duration&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start</span><span style="color: #007700">))&nbsp;/&nbsp;</span><span style="color: #0000BB">3600</span><span style="color: #007700">;<br /><a name="l104" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'minTime'</span><span style="color: #007700">]&nbsp;?&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'minTime'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">$duration</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;minimum&nbsp;time&nbsp;interval<br /><a name="l105" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><a name="l106" /><br /><a name="l107" /><br /><a name="l108" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;return&nbsp;string&nbsp;form&nbsp;of&nbsp;duration&nbsp;in&nbsp;hh:mm:ss&nbsp;format<br /><a name="l109" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">duration_string</span><span style="color: #007700">()&nbsp;{<br /><a name="l110" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$duration&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start</span><span style="color: #007700">);<br /><a name="l111" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$hour&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">floor</span><span style="color: #007700">(</span><span style="color: #0000BB">$duration&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">3600</span><span style="color: #007700">);<br /><a name="l112" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$hour&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">800</span><span style="color: #007700">)&nbsp;return&nbsp;</span><span style="color: #DD0000">"800:00:00"</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;max&nbsp;visable&nbsp;duration<br /><a name="l113" /><br /><a name="l114" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$minute&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$duration&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">60&nbsp;</span><span style="color: #007700">%&nbsp;</span><span style="color: #0000BB">60</span><span style="color: #007700">;<br /><a name="l115" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$second&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$duration&nbsp;</span><span style="color: #007700">%&nbsp;</span><span style="color: #0000BB">60</span><span style="color: #007700">;<br /><a name="l116" /><br /><a name="l117" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$hour</span><span style="color: #DD0000">:</span><span style="color: #0000BB">$minute</span><span style="color: #DD0000">:</span><span style="color: #0000BB">$second</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br /><a name="l118" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l119" /><br /><a name="l120" /><br /><a name="l121" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;if&nbsp;the&nbsp;values&nbsp;are&nbsp;different&nbsp;then&nbsp;update&nbsp;the&nbsp;DB<br /><a name="l122" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">edit_transaction_information</span><span style="color: #007700">(</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">){<br /><a name="l123" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;return;<br /><a name="l124" /><br /><a name="l125" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"duration"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"duration"</span><span style="color: #007700">];<br /><a name="l126" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"filename"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"filename"</span><span style="color: #007700">];<br /><a name="l127" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"notes"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"notes"</span><span style="color: #007700">];<br /><a name="l128" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$this-&gt;setT_end(date("Y-m-d&nbsp;H:i:s",strtotime($t_end)));&nbsp;&nbsp;//KEEP&nbsp;as&nbsp;example&nbsp;of&nbsp;format&nbsp;for&nbsp;time_end&nbsp;format<br /><a name="l129" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"t_start"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"t_start"</span><span style="color: #007700">];<br /><a name="l130" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"t_end"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"t_end"</span><span style="color: #007700">];<br /><a name="l131" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"pickup_time"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pickup_time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"pickup_time"</span><span style="color: #007700">];<br /><a name="l132" /><br /><a name="l133" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;OBJs<br /><a name="l134" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"device"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"device"</span><span style="color: #007700">];<br /><a name="l135" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"operator"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"operator"</span><span style="color: #007700">];<br /><a name="l136" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"pickedup_by"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pickedup_by&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"pickedup_by"</span><span style="color: #007700">];<br /><a name="l137" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"staff"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">staff&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"staff"</span><span style="color: #007700">];<br /><a name="l138" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"status"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$change_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"status"</span><span style="color: #007700">];<br /><a name="l139" /><br /><a name="l140" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">update_transaction</span><span style="color: #007700">();<br /><a name="l141" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l142" /><br /><a name="l143" /><br /><a name="l144" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l145" />&nbsp;&nbsp;&nbsp;&nbsp;takes&nbsp;in&nbsp;future&nbsp;status&nbsp;of&nbsp;ended&nbsp;transaction,&nbsp;OBJ&nbsp;of&nbsp;who&nbsp;ends&nbsp;it,&nbsp;optional&nbsp;array&nbsp;to&nbsp;specifiy<br /><a name="l146" />&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;material&nbsp;statuses&nbsp;(if&nbsp;some&nbsp;but&nbsp;not&nbsp;all&nbsp;failed/succeeded/cancelled)<br /><a name="l147" />&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><a name="l148" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">end_transaction</span><span style="color: #007700">(</span><span style="color: #0000BB">$staff</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status_id</span><span style="color: #007700">){<br /><a name="l149" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$role</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">;<br /><a name="l150" /><br /><a name="l151" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">staff&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">;<br /><a name="l152" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Status</span><span style="color: #007700">(</span><span style="color: #0000BB">$status_id</span><span style="color: #007700">);<br /><a name="l153" /><br /><a name="l154" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;only&nbsp;staff&nbsp;may&nbsp;close&nbsp;the&nbsp;ticket<br /><a name="l155" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleID&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$role</span><span style="color: #007700">[</span><span style="color: #DD0000">"staff"</span><span style="color: #007700">])&nbsp;return&nbsp;</span><span style="color: #DD0000">"Please&nbsp;ask&nbsp;a&nbsp;staff&nbsp;member&nbsp;to&nbsp;close&nbsp;this&nbsp;ticket.&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleID</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br /><a name="l156" /><br /><a name="l157" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;restrict&nbsp;users&nbsp;below&nbsp;editTrans&nbsp;level&nbsp;from&nbsp;ending&nbsp;own&nbsp;tickets<br /><a name="l158" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getRoleID</span><span style="color: #007700">()&nbsp;&lt;&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'editTrans'</span><span style="color: #007700">])<br /><a name="l159" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"Please&nbsp;ask&nbsp;a&nbsp;fellow&nbsp;staff&nbsp;member&nbsp;to&nbsp;close&nbsp;this&nbsp;ticket."</span><span style="color: #007700">;<br /><a name="l160" /><br /><a name="l161" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"Y-m-d&nbsp;H:i:s"</span><span style="color: #007700">);<br /><a name="l162" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">update_transaction</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;return&nbsp;error&nbsp;or&nbsp;null&nbsp;(no&nbsp;error)<br /><a name="l163" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><a name="l164" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l165" /><br /><a name="l166" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">end_juicebox</span><span style="color: #007700">(){<br /><a name="l167" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">;<br /><a name="l168" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l169" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$total&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quote_cost</span><span style="color: #007700">();<br /><a name="l170" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Status&nbsp;=&nbsp;Moveable<br /><a name="l171" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Intended&nbsp;to&nbsp;block&nbsp;additional&nbsp;Power&nbsp;On&nbsp;Until&nbsp;Learner&nbsp;Pays&nbsp;Balance<br /><a name="l172" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Alt&nbsp;logic,&nbsp;payments&nbsp;get&nbsp;placed&nbsp;into&nbsp;a&nbsp;"tab"<br /><a name="l173" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">abs</span><span style="color: #007700">(</span><span style="color: #0000BB">$total&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">0.001</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">.005</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Status</span><span style="color: #007700">(</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"moveable"</span><span style="color: #007700">]);<br /><a name="l174" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Status</span><span style="color: #007700">(</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"complete"</span><span style="color: #007700">]);<br /><a name="l175" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;null&nbsp;for&nbsp;no&nbsp;error,&nbsp;string&nbsp;for&nbsp;error<br /><a name="l176" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">update_transaction</span><span style="color: #007700">();<br /><a name="l177" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l178" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l179" /><br /><a name="l180" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">end_octopuppet</span><span style="color: #007700">(){<br /><a name="l181" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">;<br /><a name="l182" /><br /><a name="l183" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"Y-m-d&nbsp;H:i:s"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #DD0000">"now"</span><span style="color: #007700">));&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;set&nbsp;t_end&nbsp;only&nbsp;for&nbsp;object&nbsp;(!DB)<br /><a name="l184" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$duration&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration_string</span><span style="color: #007700">();<br /><a name="l185" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l186" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;`transactions`<br /><a name="l187" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;`duration`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$duration</span><span style="color: #DD0000">',&nbsp;`status_id`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #0000BB">moveable</span><span style="color: #007700">]</span><span style="color: #DD0000">'<br /><a name="l188" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`trans_id`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id</span><span style="color: #DD0000">';<br /><a name="l189" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l190" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">affected_rows&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><a name="l191" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l192" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;unsuccessful<br /><a name="l193" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><a name="l194" /><br /><a name="l195" /><br /><a name="l196" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">endSheetTicket</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sheet_good_status</span><span style="color: #007700">){<br /><a name="l197" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">;<br /><a name="l198" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l199" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;1&nbsp;for&nbsp;complete,&nbsp;2&nbsp;for&nbsp;failed<br /><a name="l200" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$status_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sheet_good_status&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"complete"</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"total_fail"</span><span style="color: #007700">];<br /><a name="l201" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l202" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l203" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l204" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;`transactions`<br /><a name="l205" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;`t_end`&nbsp;=&nbsp;CURRENT_TIMESTAMP&nbsp;,&nbsp;`status_id`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$status_id</span><span style="color: #DD0000">'<br /><a name="l206" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`trans_id`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$trans_id</span><span style="color: #DD0000">';<br /><a name="l207" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">))<br /><a name="l208" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /><a name="l209" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><a name="l210" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l211" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l212" /><br /><a name="l213" /><br /><a name="l214" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">insertSheetTrans</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$inv_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">){<br /><a name="l215" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">;<br /><a name="l216" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l217" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l218" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;INTO&nbsp;`sheet_good_transactions`&nbsp;<br /><a name="l219" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(`trans_id`,&nbsp;`inv_id`,&nbsp;`quantity`,&nbsp;`remove_date`)&nbsp;<br /><a name="l220" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES<br /><a name="l221" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('</span><span style="color: #0000BB">$trans_id</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #0000BB">$inv_id</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #0000BB">$quantity</span><span style="color: #DD0000">',&nbsp;CURRENT_TIMESTAMP);<br /><a name="l222" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l223" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><a name="l224" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><a name="l225" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l226" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l227" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l228" /><br /><a name="l229" /><br /><a name="l230" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;create&nbsp;a&nbsp;new&nbsp;transaction&nbsp;in&nbsp;DB&nbsp;and&nbsp;return&nbsp;trans_id&nbsp;to&nbsp;associate&nbsp;with<br /><a name="l231" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">insert_new_transaction</span><span style="color: #007700">(</span><span style="color: #0000BB">$operator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$device_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$est_time</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$p_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$note</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br /><a name="l232" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">;<br /><a name="l233" /><br /><a name="l234" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Validate&nbsp;input&nbsp;variables<br /><a name="l235" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">Devices</span><span style="color: #007700">::</span><span style="color: #0000BB">regexDeviceID</span><span style="color: #007700">(</span><span style="color: #0000BB">$device_id</span><span style="color: #007700">))return&nbsp;</span><span style="color: #DD0000">"Bad&nbsp;Device"</span><span style="color: #007700">;<br /><a name="l236" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">Devices</span><span style="color: #007700">::</span><span style="color: #0000BB">is_open</span><span style="color: #007700">(</span><span style="color: #0000BB">$device_id</span><span style="color: #007700">))&nbsp;return&nbsp;</span><span style="color: #DD0000">"Is&nbsp;Open"</span><span style="color: #007700">;<br /><a name="l237" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$est_time&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;!</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">regexTime</span><span style="color: #007700">(</span><span style="color: #0000BB">$est_time</span><span style="color: #007700">))&nbsp;return&nbsp;</span><span style="color: #DD0000">"Bad&nbsp;Time&nbsp;-&nbsp;</span><span style="color: #0000BB">$est_time</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br /><a name="l238" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Purpose</span><span style="color: #007700">::</span><span style="color: #0000BB">regexID</span><span style="color: #007700">(</span><span style="color: #0000BB">$p_id</span><span style="color: #007700">))&nbsp;return&nbsp;</span><span style="color: #DD0000">"Invalid&nbsp;Purpose&nbsp;-&nbsp;</span><span style="color: #0000BB">$p_id</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br /><a name="l239" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$status_id&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;!</span><span style="color: #0000BB">Status</span><span style="color: #007700">::</span><span style="color: #0000BB">regexID</span><span style="color: #007700">(</span><span style="color: #0000BB">$status_id</span><span style="color: #007700">))&nbsp;return&nbsp;</span><span style="color: #DD0000">"Invalid&nbsp;Status"</span><span style="color: #007700">;<br /><a name="l240" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$note&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$note&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #DD0000">"'"</span><span style="color: #007700">.</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">regexNotes</span><span style="color: #007700">(</span><span style="color: #0000BB">$note</span><span style="color: #007700">).</span><span style="color: #DD0000">"'"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">"NULL"</span><span style="color: #007700">;<br /><a name="l241" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l242" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$error&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Wait_queue</span><span style="color: #007700">::</span><span style="color: #0000BB">transferFromWaitQueue</span><span style="color: #007700">(</span><span style="color: #0000BB">$operator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$device_id</span><span style="color: #007700">))&nbsp;return&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">;<br /><a name="l243" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l244" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$t_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$status_id&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"sheet_sale"</span><span style="color: #007700">]&nbsp;?&nbsp;</span><span style="color: #DD0000">"CURRENT_TIMESTAMP"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">"NULL"</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;sheet&nbsp;goods<br /><a name="l245" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;$note&nbsp;is&nbsp;intentionally&nbsp;left&nbsp;without&nbsp;''&nbsp;so&nbsp;that&nbsp;if&nbsp;it&nbsp;is&nbsp;null,&nbsp;it&nbsp;will&nbsp;be&nbsp;entered&nbsp;as&nbsp;a&nbsp;null&nbsp;value<br /><a name="l246" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;transactions&nbsp;<br /><a name="l247" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(`operator`,&nbsp;`d_id`,&nbsp;`t_start`,&nbsp;`t_end`,&nbsp;`status_id`,&nbsp;`p_id`,&nbsp;`est_time`,&nbsp;`staff_id`,&nbsp;`notes`)&nbsp;<br /><a name="l248" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;(`operator`,`device_id`,`t_start`,`status_id`,`p_id`,`est_time`,`staff_id`,&nbsp;`notes`)&nbsp;<br /><a name="l249" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES<br /><a name="l250" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('</span><span style="color: #0000BB">$operator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #0000BB">$device_id</span><span style="color: #DD0000">',&nbsp;CURRENT_TIMESTAMP,&nbsp;</span><span style="color: #0000BB">$t_end</span><span style="color: #DD0000">,&nbsp;'</span><span style="color: #0000BB">$status_id</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #0000BB">$p_id</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #0000BB">$est_time</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">',&nbsp;</span><span style="color: #0000BB">$note</span><span style="color: #DD0000">);"<br /><a name="l251" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">)){<br /><a name="l252" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert_id</span><span style="color: #007700">;<br /><a name="l253" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l254" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">;<br /><a name="l255" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l256" /><br /><a name="l257" /><br /><a name="l258" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l259" />&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;that&nbsp;the&nbsp;materials&nbsp;associated&nbsp;with&nbsp;transaction&nbsp;are&nbsp;not&nbsp;chargable.&nbsp;<br /><a name="l260" />&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;materials&nbsp;has&nbsp;cost,&nbsp;user&nbsp;must&nbsp;pay&nbsp;for&nbsp;it.<br /><a name="l261" />&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><a name="l262" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">no_associated_materials_have_a_price</span><span style="color: #007700">()&nbsp;{<br /><a name="l263" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mats_used&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">)<br /><a name="l264" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">price</span><span style="color: #007700">)&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l265" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><a name="l266" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l267" /><br /><a name="l268" /><br /><a name="l269" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;prints&nbsp;the&nbsp;thermal&nbsp;ticket<br /><a name="l270" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">printTicket</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">){<br /><a name="l271" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tp</span><span style="color: #007700">;<br /><a name="l272" /><br /><a name="l273" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l274" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ticket&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);&nbsp;&nbsp;</span><span style="color: #FF8000">//Pull&nbsp;Ticket&nbsp;Related&nbsp;Information<br /><a name="l275" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><a name="l276" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l277" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">;<br /><a name="l278" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br /><a name="l279" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l280" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l281" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l282" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$tpn&nbsp;=&nbsp;0;&nbsp;&nbsp;//&nbsp;no&nbsp;other&nbsp;thermal&nbsp;printers&nbsp;||&nbsp;multiple&nbsp;not&nbsp;implemented:&nbsp;default&nbsp;to&nbsp;first&nbsp;in&nbsp;queue<br /><a name="l283" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tpn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device_group</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">thermal_printer_num</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;get&nbsp;from&nbsp;list&nbsp;of&nbsp;thermal&nbsp;printers&nbsp;based&nbsp;on&nbsp;device&nbsp;location<br /><a name="l284" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connector&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">NetworkPrintConnector</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$tp</span><span style="color: #007700">[</span><span style="color: #0000BB">$tpn</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$tp</span><span style="color: #007700">[</span><span style="color: #0000BB">$tpn</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br /><a name="l285" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Printer</span><span style="color: #007700">(</span><span style="color: #0000BB">$connector</span><span style="color: #007700">);<br /><a name="l286" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l287" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l288" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"Couldn't&nbsp;print&nbsp;to&nbsp;this&nbsp;printer:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><a name="l289" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l290" /><br /><a name="l291" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l292" /><br /><a name="l293" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Print&nbsp;Generic&nbsp;Header<br /><a name="l294" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$img&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">EscposImage</span><span style="color: #007700">::</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #0000BB">DOCUMENT_ROOT</span><span style="color: #007700">]</span><span style="color: #DD0000">/images/</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #0000BB">icon2</span><span style="color: #007700">]</span><span style="color: #DD0000">"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);&nbsp;&nbsp;</span><span style="color: #FF8000">//TODO:&nbsp;change&nbsp;to&nbsp;$sv<br /><a name="l295" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_CENTER</span><span style="color: #007700">);<br /><a name="l296" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">graphics</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /><a name="l297" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l298" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Ticket:&nbsp;</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /><a name="l299" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l300" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start</span><span style="color: #007700">);<br /><a name="l301" /><br /><a name="l302" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Body<br /><a name="l303" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l304" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Device:&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">);<br /><a name="l305" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l306" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;estimated&nbsp;amount<br /><a name="l307" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$est_amount&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><a name="l308" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mats_used&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">)<br /><a name="l309" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$est_amount&nbsp;</span><span style="color: #007700">+=&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quantity_used</span><span style="color: #007700">;<br /><a name="l310" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l311" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Est.&nbsp;Amount:&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$est_amount</span><span style="color: #DD0000">&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">unit</span><span style="color: #007700">);<br /><a name="l312" /><br /><a name="l313" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l314" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Est.&nbsp;Cost:&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">);<br /><a name="l315" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"$&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">number_format</span><span style="color: #007700">(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quote_cost</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">));<br /><a name="l316" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l317" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">est_time</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Est.&nbsp;Duration:&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">est_time</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /><a name="l318" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l319" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename</span><span style="color: #007700">){<br /><a name="l320" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l321" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"File:&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /><a name="l322" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l323" /><br /><a name="l324" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l325" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device_group</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">is_storable&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">"Y"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">StorageObject</span><span style="color: #007700">::</span><span style="color: #0000BB">object_is_in_storage</span><span style="color: #007700">(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id</span><span style="color: #007700">)){<br /><a name="l326" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$storage_object&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">StorageObject</span><span style="color: #007700">(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id</span><span style="color: #007700">);<br /><a name="l327" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Address:&nbsp;</span><span style="color: #0000BB">$storage_object</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">box_id</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /><a name="l328" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l329" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Address:&nbsp;________________"</span><span style="color: #007700">);<br /><a name="l330" /><br /><a name="l331" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l332" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Potential&nbsp;Problems?&nbsp;&nbsp;(&nbsp;Y&nbsp;)&nbsp;&nbsp;(&nbsp;N&nbsp;)"</span><span style="color: #007700">);<br /><a name="l333" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Print&nbsp;Color&nbsp;Swap&nbsp;Instructions<br /><a name="l334" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l335" /><br /><a name="l336" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;UPDATE&nbsp;FOR&nbsp;MULTI-MATERIAL&nbsp;OCTOPUPPET&nbsp;CHANGE<br /><a name="l337" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;if(count($ticket-&gt;mats_used)&nbsp;&gt;&nbsp;1)&nbsp;{<br /><a name="l338" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$printer-&gt;feed();<br /><a name="l339" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$printer-&gt;text("Color&nbsp;Swap");<br /><a name="l340" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;}<br /><a name="l341" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;for($x&nbsp;=&nbsp;count($ticket-&gt;mats_used);&nbsp;0&nbsp;&lt;&nbsp;$x;&nbsp;$x--)&nbsp;{<br /><a name="l342" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$printer-&gt;feed();<br /><a name="l343" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$printer-&gt;text(str_pad((count($ticket-&gt;mats_used)&nbsp;-&nbsp;$x&nbsp;+1).":",&nbsp;5,&nbsp;"&nbsp;").str_pad($ticket-&gt;mats_used[$x-1]-&gt;material-&gt;m_name,&nbsp;20,&nbsp;"_"));<br /><a name="l344" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;}<br /><a name="l345" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"[["</span><span style="color: #007700">))&nbsp;{<br /><a name="l346" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$filename_materials&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"[["</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename</span><span style="color: #007700">);<br /><a name="l347" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename_materials</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$x</span><span style="color: #007700">++)&nbsp;{<br /><a name="l348" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename_materials</span><span style="color: #007700">[</span><span style="color: #0000BB">$x</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">".gcode"</span><span style="color: #007700">))<br /><a name="l349" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$filename_materials</span><span style="color: #007700">[</span><span style="color: #0000BB">$x</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename_materials</span><span style="color: #007700">[</span><span style="color: #0000BB">$x</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strpos</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename_materials</span><span style="color: #007700">[</span><span style="color: #0000BB">$x</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">".gcode"</span><span style="color: #007700">));<br /><a name="l350" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$material&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Materials</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename_materials</span><span style="color: #007700">[</span><span style="color: #0000BB">$x</span><span style="color: #007700">]);<br /><a name="l351" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">is_object</span><span style="color: #007700">(</span><span style="color: #0000BB">$material</span><span style="color: #007700">))&nbsp;{<br /><a name="l352" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">str_pad</span><span style="color: #007700">((</span><span style="color: #0000BB">$x</span><span style="color: #007700">).</span><span style="color: #DD0000">":"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">).</span><span style="color: #0000BB">str_pad</span><span style="color: #007700">(</span><span style="color: #0000BB">$material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"_"</span><span style="color: #007700">));<br /><a name="l353" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l354" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l355" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l356" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l357" /><br /><a name="l358" /><br /><a name="l359" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l360" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"NOTES:&nbsp;_________________________"</span><span style="color: #007700">);<br /><a name="l361" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l362" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"________________________________"</span><span style="color: #007700">);<br /><a name="l363" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l364" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"________________________________"</span><span style="color: #007700">);<br /><a name="l365" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;footer<br /><a name="l366" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /><a name="l367" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">graphics</span><span style="color: #007700">(</span><span style="color: #0000BB">EscposImage</span><span style="color: #007700">::</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">].</span><span style="color: #DD0000">"/images/sig.png"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">));<br /><a name="l368" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l369" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'website_url'</span><span style="color: #007700">]);&nbsp;&nbsp;</span><span style="color: #FF8000">//TODO:&nbsp;change&nbsp;to&nbsp;$sv<br /><a name="l370" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l371" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'phone_number'</span><span style="color: #007700">]);&nbsp;&nbsp;</span><span style="color: #FF8000">//TODO:&nbsp;change&nbsp;to&nbsp;$sv<br /><a name="l372" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l373" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cut</span><span style="color: #007700">();<br /><a name="l374" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l375" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$print_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l376" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$print_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br /><a name="l377" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l378" /><br /><a name="l379" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l380" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//Close&nbsp;printer<br /><a name="l381" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><a name="l382" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch(&nbsp;</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l383" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"printer&nbsp;was&nbsp;not&nbsp;open"</span><span style="color: #007700">;<br /><a name="l384" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l385" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l386" /><br /><a name="l387" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">printSheetTicket</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$cart_inv_ids</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$cart_quantities</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$cart_prices</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$total_price</span><span style="color: #007700">){<br /><a name="l388" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">;<br /><a name="l389" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$tp</span><span style="color: #007700">;<br /><a name="l390" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sheet_names&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><a name="l391" /><br /><a name="l392" /><br /><a name="l393" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(</span><span style="color: #0000BB">$cart_inv_ids</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br /><a name="l394" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l395" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;`materials`.`m_name`&nbsp;,&nbsp;`sheet_good_inventory`.`width`&nbsp;,&nbsp;`sheet_good_inventory`.`height`<br /><a name="l396" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;`sheet_good_inventory`,&nbsp;`materials`<br /><a name="l397" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`sheet_good_inventory`.`inv_ID`&nbsp;=&nbsp;'</span><span style="color: #0000BB">$cart_inv_ids</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]</span><span style="color: #DD0000">'&nbsp;AND&nbsp;`materials`.`m_id`&nbsp;=&nbsp;`sheet_good_inventory`.`m_ID`<br /><a name="l398" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">)){<br /><a name="l399" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">();<br /><a name="l400" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sheet_names</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"m_name"</span><span style="color: #007700">].</span><span style="color: #DD0000">"&nbsp;-&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"width"</span><span style="color: #007700">].</span><span style="color: #DD0000">"(in)x"</span><span style="color: #007700">.</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"height"</span><span style="color: #007700">].</span><span style="color: #DD0000">"(in)"</span><span style="color: #007700">;<br /><a name="l401" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l402" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l403" /><br /><a name="l404" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Set&nbsp;up&nbsp;Printer&nbsp;Connection<br /><a name="l405" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tp_number&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><a name="l406" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l407" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connector&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">NetworkPrintConnector</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$tp</span><span style="color: #007700">[</span><span style="color: #0000BB">$tp_number</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$tp</span><span style="color: #007700">[</span><span style="color: #0000BB">$tp_number</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br /><a name="l408" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Printer</span><span style="color: #007700">(</span><span style="color: #0000BB">$connector</span><span style="color: #007700">);<br /><a name="l409" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l410" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"Couldn't&nbsp;print&nbsp;to&nbsp;this&nbsp;printer:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><a name="l411" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l412" /><br /><a name="l413" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l414" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$img&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">EscposImage</span><span style="color: #007700">::</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">].</span><span style="color: #DD0000">"/images/fablab2.png"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><a name="l415" /><br /><a name="l416" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_CENTER</span><span style="color: #007700">);<br /><a name="l417" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">graphics</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /><a name="l418" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l419" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l420" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"F&nbsp;jS&nbsp;Y&nbsp;h:i&nbsp;A"</span><span style="color: #007700">));<br /><a name="l421" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /><a name="l422" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l423" /><br /><a name="l424" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setTextSize</span><span style="color: #007700">(</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">);<br /><a name="l425" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);<br /><a name="l426" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /><a name="l427" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_LEFT</span><span style="color: #007700">);<br /><a name="l428" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setTextSize</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l429" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l430" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"SALE:"</span><span style="color: #007700">);<br /><a name="l431" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /><a name="l432" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_LEFT</span><span style="color: #007700">);<br /><a name="l433" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(</span><span style="color: #0000BB">$cart_inv_ids</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br /><a name="l434" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setTextSize</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l435" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l436" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_LEFT</span><span style="color: #007700">);<br /><a name="l437" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l438" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">$cart_quantities</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">].</span><span style="color: #DD0000">""</span><span style="color: #007700">);<br /><a name="l439" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /><a name="l440" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$sheet_names</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]);<br /><a name="l441" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l442" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_RIGHT</span><span style="color: #007700">);<br /><a name="l443" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l444" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">$cart_prices</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]);<br /><a name="l445" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l446" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setTextSize</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l447" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);&nbsp;<br /><a name="l448" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_RIGHT</span><span style="color: #007700">);<br /><a name="l449" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l450" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"Total:&nbsp;$"</span><span style="color: #007700">.</span><span style="color: #0000BB">$total_price</span><span style="color: #007700">);<br /><a name="l451" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /><a name="l452" /><br /><a name="l453" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);&nbsp;&nbsp;<br /><a name="l454" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l455" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Print&nbsp;Footer<br /><a name="l456" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setJustification</span><span style="color: #007700">(</span><span style="color: #0000BB">Printer</span><span style="color: #007700">::</span><span style="color: #0000BB">JUSTIFY_CENTER</span><span style="color: #007700">);<br /><a name="l457" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"For&nbsp;information&nbsp;about&nbsp;FabLab's"</span><span style="color: #007700">);<br /><a name="l458" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l459" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"return&nbsp;policy&nbsp;visit:"</span><span style="color: #007700">);<br /><a name="l460" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l461" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">setEmphasis</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l462" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://fablab.uta.edu/policy"</span><span style="color: #007700">);<br /><a name="l463" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l464" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l465" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$print_error</span><span style="color: #007700">)&nbsp;{<br /><a name="l466" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//echo&nbsp;$print_error-&gt;getMessage();<br /><a name="l467" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">text</span><span style="color: #007700">(</span><span style="color: #0000BB">$print_error</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">());<br /><a name="l468" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l469" /><br /><a name="l470" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Close&nbsp;Printer&nbsp;Connection<br /><a name="l471" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">try&nbsp;{<br /><a name="l472" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">feed</span><span style="color: #007700">();<br /><a name="l473" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">cut</span><span style="color: #007700">();<br /><a name="l474" /><br /><a name="l475" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Close&nbsp;printer&nbsp;*/<br /><a name="l476" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$printer&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /><a name="l477" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l478" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Couldn't&nbsp;print&nbsp;to&nbsp;this&nbsp;printer:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><a name="l479" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l480" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l481" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l482" /><br /><a name="l483" /><br /><a name="l484" /><br /><a name="l485" /><br /><a name="l486" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;return&nbsp;the&nbsp;cost&nbsp;for&nbsp;this&nbsp;ticket&nbsp;based&nbsp;on&nbsp;materials&nbsp;used&nbsp;excluding&nbsp;amount<br /><a name="l487" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">quote_cost</span><span style="color: #007700">()&nbsp;{<br /><a name="l488" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">;<br /><a name="l489" /><br /><a name="l490" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cost&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><a name="l491" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;sum&nbsp;materials&nbsp;costs&nbsp;that&nbsp;are&nbsp;not&nbsp;failed<br /><a name="l492" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mats_used&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$mu</span><span style="color: #007700">)&nbsp;{<br /><a name="l493" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$mu</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status_id&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">'failed_mat'</span><span style="color: #007700">])&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;failed&nbsp;materials&nbsp;are&nbsp;not&nbsp;charged&nbsp;to&nbsp;user<br /><a name="l494" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cost&nbsp;</span><span style="color: #007700">+=&nbsp;</span><span style="color: #0000BB">abs</span><span style="color: #007700">(</span><span style="color: #0000BB">$mu</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quantity_used</span><span style="color: #007700">)&nbsp;*&nbsp;</span><span style="color: #0000BB">$mu</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">price</span><span style="color: #007700">;<br /><a name="l495" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l496" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">&lt;=&nbsp;</span><span style="color: #0000BB">$cost&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$cost&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">.005</span><span style="color: #007700">)&nbsp;?&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">$cost</span><span style="color: #007700">;<br /><a name="l497" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l498" /><br /><a name="l499" /><br /><a name="l500" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;information&nbsp;about&nbsp;who&nbsp;pickuped&nbsp;a&nbsp;transaction,&nbsp;when&nbsp;and&nbsp;by&nbsp;whom&nbsp;it&nbsp;was&nbsp;facilitated<br /><a name="l501" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">record_pickup</span><span style="color: #007700">(</span><span style="color: #0000BB">$reciever</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">)&nbsp;{<br /><a name="l502" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">edit_transaction_information</span><span style="color: #007700">(array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"pickedup_by"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$reciever</span><span style="color: #007700">,&nbsp;<br /><a name="l503" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"pickup_time"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"Y-m-d&nbsp;H:i:s"</span><span style="color: #007700">),&nbsp;<br /><a name="l504" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"staff"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">));<br /><a name="l505" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l506" /><br /><a name="l507" /><br /><a name="l508" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;the&nbsp;cost&nbsp;of&nbsp;materials&nbsp;-&nbsp;the&nbsp;amount&nbsp;already&nbsp;paid&nbsp;towards&nbsp;the&nbsp;transaction<br /><a name="l509" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">remaining_balance</span><span style="color: #007700">()&nbsp;{<br /><a name="l510" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;current&nbsp;cost&nbsp;-&nbsp;(already&nbsp;been&nbsp;paid)&nbsp;+&nbsp;.001&nbsp;(prevent&nbsp;negative&nbsp;rounding&nbsp;errors)<br /><a name="l511" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$balance&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quote_cost</span><span style="color: #007700">()&nbsp;-&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">current_transaction_credit</span><span style="color: #007700">()&nbsp;+&nbsp;</span><span style="color: #0000BB">.001</span><span style="color: #007700">;<br /><a name="l512" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;allow&nbsp;for&nbsp;.005&nbsp;rounding&nbsp;error<br /><a name="l513" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;(-</span><span style="color: #0000BB">.005&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$balance&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$balance&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">.005</span><span style="color: #007700">)&nbsp;?&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">$balance</span><span style="color: #007700">;&nbsp;<br /><a name="l514" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l515" /><br /><a name="l516" /><br /><a name="l517" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;write&nbsp;all&nbsp;variables&nbsp;to&nbsp;the&nbsp;DB&nbsp;for&nbsp;a&nbsp;given&nbsp;Transaction<br /><a name="l518" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">update_transaction</span><span style="color: #007700">()&nbsp;{<br /><a name="l519" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">;<br /><a name="l520" /><br /><a name="l521" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;prevent&nbsp;error&nbsp;from&nbsp;accessing&nbsp;null's&nbsp;attributes<br /><a name="l522" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pickedup_by&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pickedup_by&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pickedup_by</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /><a name="l523" /><br /><a name="l524" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;update&nbsp;transaction&nbsp;info<br /><a name="l525" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$statement&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"UPDATE&nbsp;`transactions`<br /><a name="l526" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;`d_id`&nbsp;=&nbsp;?,&nbsp;`operator`&nbsp;=&nbsp;?,&nbsp;`t_start`&nbsp;=&nbsp;?,&nbsp;<br /><a name="l527" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`t_end`&nbsp;=&nbsp;?,&nbsp;`status_id`&nbsp;=&nbsp;?,&nbsp;`staff_id`&nbsp;=&nbsp;?,&nbsp;<br /><a name="l528" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`pickup_time`&nbsp;=&nbsp;?,&nbsp;`pickedup_by`&nbsp;=&nbsp;?,&nbsp;&nbsp;`notes`&nbsp;=&nbsp;?,<br /><a name="l529" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`duration`&nbsp;=&nbsp;?<br /><a name="l530" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;`trans_id`&nbsp;=&nbsp;?;"</span><span style="color: #007700">);<br /><a name="l531" /><br /><a name="l532" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$statement</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bind_param</span><span style="color: #007700">(</span><span style="color: #DD0000">"dsssdsssssd"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start</span><span style="color: #007700">,&nbsp;<br /><a name="l533" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #007700">,&nbsp;<br /><a name="l534" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pickup_time</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pickedup_by</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename_and_notes</span><span style="color: #007700">(),&nbsp;<br /><a name="l535" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration</span><span style="color: #007700">,<br /><a name="l536" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id</span><span style="color: #007700">);<br /><a name="l537" /><br /><a name="l538" /><br /><a name="l539" /><br /><a name="l540" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">$statement</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">())&nbsp;return&nbsp;</span><span style="color: #DD0000">"Could&nbsp;not&nbsp;update&nbsp;transaction&nbsp;values"</span><span style="color: #007700">;<br /><a name="l541" /><br /><a name="l542" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;no&nbsp;errors<br /><a name="l543" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><a name="l544" /><br /><a name="l545" /><br /><a name="l546" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;————————————————&nbsp;ATTRIBUTES&nbsp;—————————————————<br /><a name="l547" /><br /><a name="l548" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">filename_and_notes</span><span style="color: #007700">()&nbsp;{<br /><a name="l549" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename</span><span style="color: #007700">)&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename</span><span style="color: #007700">.</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes</span><span style="color: #007700">;<br /><a name="l550" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes</span><span style="color: #007700">;<br /><a name="l551" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l552" /><br /><a name="l553" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getT_start</span><span style="color: #007700">()&nbsp;{<br /><a name="l554" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">;<br /><a name="l555" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'dateFormat'</span><span style="color: #007700">],</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start</span><span style="color: #007700">));<br /><a name="l556" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l557" /><br /><a name="l558" /><br /><a name="l559" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getT_start_picker</span><span style="color: #007700">()&nbsp;{<br /><a name="l560" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"m/d/Y&nbsp;g:i&nbsp;a"</span><span style="color: #007700">,</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_start</span><span style="color: #007700">));<br /><a name="l561" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l562" /><br /><a name="l563" /><br /><a name="l564" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getT_end</span><span style="color: #007700">()&nbsp;{<br /><a name="l565" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$sv</span><span style="color: #007700">;<br /><a name="l566" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">strcmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)<br /><a name="l567" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l568" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #DD0000">'dateFormat'</span><span style="color: #007700">],</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end</span><span style="color: #007700">));<br /><a name="l569" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l570" /><br /><a name="l571" /><br /><a name="l572" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getT_end_picker</span><span style="color: #007700">()&nbsp;{<br /><a name="l573" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">strcmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)<br /><a name="l574" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l575" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"m/d/Y&nbsp;g:i&nbsp;a"</span><span style="color: #007700">,</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">t_end</span><span style="color: #007700">));<br /><a name="l576" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l577" /><br /><a name="l578" /><br /><a name="l579" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;filename,&nbsp;if&nbsp;contained&nbsp;in&nbsp;note;&nbsp;otherwise&nbsp;null&nbsp;filename<br /><a name="l580" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">set_filename_and_notes</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_notes</span><span style="color: #007700">){<br /><a name="l581" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_notes</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">)&nbsp;?&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$trans_notes</span><span style="color: #007700">)[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /><a name="l582" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_notes</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">)&nbsp;?&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"⦂"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$trans_notes</span><span style="color: #007700">)[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">$trans_notes</span><span style="color: #007700">;<br /><a name="l583" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l584" /><br /><a name="l585" /><br /><a name="l586" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l587" />&nbsp;&nbsp;&nbsp;&nbsp;TODO:&nbsp;update&nbsp;external&nbsp;functions:<br /><a name="l588" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;duration&nbsp;//&nbsp;returns&nbsp;explode(":",&nbsp;this-&gt;duration)&nbsp;"${hour}h&nbsp;${minute}m&nbsp;${second}s";<br /><a name="l589" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end_juicebox()&nbsp;//&nbsp;returns&nbsp;if(error)<br /><a name="l590" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flud&nbsp;&nbsp;//&nbsp;filename<br /><a name="l591" />&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><a name="l592" /><br /><a name="l593" /><br /><a name="l594" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;—————————————————&nbsp;REGEX&nbsp;——————————————————<br /><a name="l595" /><br /><a name="l596" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">regexNotes</span><span style="color: #007700">(</span><span style="color: #0000BB">$notes</span><span style="color: #007700">)&nbsp;{<br /><a name="l597" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$notes</span><span style="color: #007700">);<br /><a name="l598" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l599" /><br /><a name="l600" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">regexTime</span><span style="color: #007700">(</span><span style="color: #0000BB">$duration</span><span style="color: #007700">)&nbsp;{<br /><a name="l601" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #DD0000">"/^\d{1,3}:\d{2}:\d{2}$/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$duration</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><a name="l602" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l603" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l604" /><br /><a name="l605" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">regexTrans</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">){<br /><a name="l606" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #DD0000">"/^\d+$/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">))&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l607" /><br /><a name="l608" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">;<br /><a name="l609" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Check&nbsp;to&nbsp;see&nbsp;if&nbsp;transaction&nbsp;exists<br /><a name="l610" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br /><a name="l611" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br /><a name="l612" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;transactions<br /><a name="l613" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;trans_id&nbsp;=&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #DD0000"><br /><a name="l614" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIMIT&nbsp;1;"<br /><a name="l615" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">)){<br /><a name="l616" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">num_rows&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><a name="l617" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l618" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l619" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l620" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l621" /><br /><a name="l622" /><br /><a name="l623" /><br /><a name="l624" /><br /><a name="l625" /></span><span style="color: #FF8000">//&nbsp;——————————————&nbsp;REMOVE&nbsp;WITH&nbsp;UPDATE&nbsp;———————————————<br /><a name="l626" />//&nbsp;—————————————————————————————————————————<br /><a name="l627" /><br /><a name="l628" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getAc</span><span style="color: #007700">()&nbsp;{<br /><a name="l629" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">acct_charge</span><span style="color: #007700">;<br /><a name="l630" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l631" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getDevice</span><span style="color: #007700">()&nbsp;{<br /><a name="l632" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device</span><span style="color: #007700">;<br /><a name="l633" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l634" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getDuration</span><span style="color: #007700">()&nbsp;{<br /><a name="l635" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">strcmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration</span><span style="color: #007700">,</span><span style="color: #DD0000">""</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)<br /><a name="l636" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l637" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sArray&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">":"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration</span><span style="color: #007700">);<br /><a name="l638" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$sArray</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]</span><span style="color: #DD0000">h&nbsp;</span><span style="color: #0000BB">$sArray</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]</span><span style="color: #DD0000">m&nbsp;</span><span style="color: #0000BB">$sArray</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]</span><span style="color: #DD0000">s"</span><span style="color: #007700">;<br /><a name="l639" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$time</span><span style="color: #007700">;<br /><a name="l640" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l641" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l642" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getDuration_raw</span><span style="color: #007700">()&nbsp;{<br /><a name="l643" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">strcmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration</span><span style="color: #007700">,</span><span style="color: #DD0000">""</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)<br /><a name="l644" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l645" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">duration</span><span style="color: #007700">;<br /><a name="l646" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l647" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getEst_time</span><span style="color: #007700">()&nbsp;{<br /><a name="l648" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">est_time</span><span style="color: #007700">;<br /><a name="l649" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l650" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getMats_used</span><span style="color: #007700">()&nbsp;{<br /><a name="l651" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mats_used</span><span style="color: #007700">;<br /><a name="l652" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l653" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getPurpose</span><span style="color: #007700">()&nbsp;{<br /><a name="l654" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">purpose</span><span style="color: #007700">;<br /><a name="l655" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l656" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getUser</span><span style="color: #007700">()&nbsp;{<br /><a name="l657" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user</span><span style="color: #007700">;<br /><a name="l658" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l659" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getStaff</span><span style="color: #007700">()&nbsp;{<br /><a name="l660" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">staff</span><span style="color: #007700">;<br /><a name="l661" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l662" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getStatus</span><span style="color: #007700">()&nbsp;{<br /><a name="l663" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status</span><span style="color: #007700">;<br /><a name="l664" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l665" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getTrans_id</span><span style="color: #007700">()&nbsp;{<br /><a name="l666" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">trans_id</span><span style="color: #007700">;<br /><a name="l667" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l668" />}<br /><a name="l669" /><br /><a name="l670" /></span><span style="color: #0000BB">?&gt;</span>
</span>